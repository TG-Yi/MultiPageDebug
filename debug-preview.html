<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>é¢„è§ˆåŠŸèƒ½è°ƒè¯•</title>
  <link rel="stylesheet" href="./shared/styles/common.css">
  <link rel="stylesheet" href="./shared/styles/theme-selector.css">
  <style>
    body {
      padding: 20px;
      font-family: sans-serif;
    }
    .debug-section {
      margin: 20px 0;
      padding: 20px;
      background: #f5f5f5;
      border-radius: 8px;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
    }
    .preview-test {
      margin-top: 20px;
      border: 2px solid #ccc;
      border-radius: 12px;
      overflow: hidden;
    }
    pre {
      background: #333;
      color: #0f0;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>ğŸ” ä¸»é¢˜é¢„è§ˆåŠŸèƒ½è°ƒè¯•</h1>

  <div class="debug-section">
    <h2>1. æ£€æŸ¥DOMç»“æ„</h2>
    <button onclick="checkPreviewElements()">æ£€æŸ¥é¢„è§ˆå…ƒç´ </button>
    <pre id="dom-check"></pre>
  </div>

  <div class="debug-section">
    <h2>2. æµ‹è¯•é¢„è§ˆæ¨ªå¹…</h2>
    <div class="preview-test">
      <div class="theme-preview-banner" id="test-banner">
        <div class="preview-gradient" id="test-gradient"></div>
        <div class="preview-info">
          <h3 class="preview-theme-name" id="test-name">æµ‹è¯•ä¸»é¢˜</h3>
          <p class="preview-theme-desc" id="test-desc">è¿™æ˜¯æµ‹è¯•æè¿°</p>
        </div>
      </div>
    </div>
    <button onclick="testUpdatePreview()">æ›´æ–°é¢„è§ˆ</button>
  </div>

  <div class="debug-section">
    <h2>3. æ‰“å¼€ä¸»é¢˜é€‰æ‹©å™¨</h2>
    <button onclick="openThemeSelector()">æ‰“å¼€ä¸»é¢˜é€‰æ‹©å™¨</button>
    <button onclick="checkModalPreview()">æ£€æŸ¥æ¨¡æ€æ¡†ä¸­çš„é¢„è§ˆ</button>
    <pre id="modal-check"></pre>
  </div>

  <div class="debug-section">
    <h2>4. æ§åˆ¶å°æ—¥å¿—</h2>
    <pre id="console-log">ç­‰å¾…æ“ä½œ...</pre>
  </div>

  <script src="./shared/scripts/common.js"></script>
  <script src="./shared/scripts/theme.js"></script>
  <script>
    const logEl = document.getElementById('console-log');
    const originalLog = console.log;
    const originalWarn = console.warn;

    // æ‹¦æˆªconsole.log
    console.log = function(...args) {
      originalLog.apply(console, args);
      logEl.textContent += `[LOG] ${args.join(' ')}\n`;
      logEl.scrollTop = logEl.scrollHeight;
    };

    console.warn = function(...args) {
      originalWarn.apply(console, args);
      logEl.textContent += `[WARN] ${args.join(' ')}\n`;
      logEl.scrollTop = logEl.scrollHeight;
    };

    function checkPreviewElements() {
      const banner = document.querySelector('.theme-preview-banner');
      const gradient = document.querySelector('.preview-gradient');
      const name = document.getElementById('preview-name');
      const desc = document.getElementById('preview-desc');

      const result = {
        'é¢„è§ˆæ¨ªå¹…': !!banner,
        'æ¸å˜å±‚': !!gradient,
        'æ ‡é¢˜å…ƒç´ ': !!name,
        'æè¿°å…ƒç´ ': !!desc,
        'æ¨ªå¹…æ•°é‡': document.querySelectorAll('.theme-preview-banner').length,
        'æ¸å˜å±‚æ•°é‡': document.querySelectorAll('.preview-gradient').length
      };

      document.getElementById('dom-check').textContent = JSON.stringify(result, null, 2);
    }

    function testUpdatePreview() {
      const gradient = document.getElementById('test-gradient');
      const name = document.getElementById('test-name');
      const desc = document.getElementById('test-desc');

      const colors = {
        bg1: '#1e3a5f',
        bg2: '#3d5a80',
        bg3: '#ee6c4d',
        bg4: '#f4a261',
        bg5: '#e9c46a',
        bg6: '#98c1d9'
      };

      const gradientStr = `linear-gradient(135deg, ${colors.bg1} 0%, ${colors.bg2} 15%, ${colors.bg3} 45%, ${colors.bg4} 65%, ${colors.bg5} 85%, ${colors.bg6} 100%)`;
      gradient.style.background = gradientStr;
      name.textContent = 'ğŸŒ… é»æ˜ç ´æ™“';
      desc.textContent = 'æ¸©æš–çš„æ—¥å‡ºæ—¶åˆ†ï¼Œå……æ»¡å¸Œæœ›';

      console.log('æµ‹è¯•é¢„è§ˆå·²æ›´æ–°');
      console.log('æ¸å˜èƒŒæ™¯:', gradientStr);
    }

    function checkModalPreview() {
      const modal = document.getElementById('theme-selector-modal');
      if (!modal) {
        document.getElementById('modal-check').textContent = 'æ¨¡æ€æ¡†æœªæ‰“å¼€';
        return;
      }

      const banner = modal.querySelector('.theme-preview-banner');
      const gradient = modal.querySelector('.preview-gradient');
      const name = modal.querySelector('#preview-name');
      const desc = modal.querySelector('#preview-desc');

      const result = {
        'æ¨¡æ€æ¡†å­˜åœ¨': !!modal,
        'é¢„è§ˆæ¨ªå¹…': !!banner,
        'æ¸å˜å±‚': !!gradient,
        'æ ‡é¢˜': name ? name.textContent : null,
        'æè¿°': desc ? desc.textContent : null,
        'æ¸å˜èƒŒæ™¯': gradient ? gradient.style.background : null
      };

      document.getElementById('modal-check').textContent = JSON.stringify(result, null, 2);
    }

    // é¡µé¢åŠ è½½å®Œæˆ
    window.addEventListener('load', () => {
      console.log('è°ƒè¯•é¡µé¢å·²åŠ è½½');
      console.log('themeManager:', window.themeManager ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨');
      console.log('å½“å‰ä¸»é¢˜:', window.themeManager?.getCurrentTheme()?.name);
      checkPreviewElements();
    });
  </script>
</body>
</html>
