<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>ËßÜÈ¢ëÊí≠ÊîæËØäÊñ≠ - ÂºÄÂèëÂ∑•ÂÖ∑ÁÆ±</title>
    <link rel="stylesheet" href="../../shared/styles/common.css" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: linear-gradient(
          135deg,
          #1e3a5f 0%,
          #3d5a80 20%,
          #ee6c4d 50%,
          #f4a261 75%,
          #e9c46a 100%
        );
        min-height: 100vh;
        padding: 20px;
      }

      .main-container {
        max-width: 900px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        gap: 20px;
        align-items: center;
      }

      .title {
        color: white;
        font-size: 28px;
        font-weight: 700;
        text-align: center;
        margin: 20px 0;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      .video-source-panel {
        width: 100%;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .source-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
      }

      .tab-btn {
        flex: 1;
        padding: 10px 20px;
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 10px;
        color: white;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        /* iOSËß¶Êë∏‰ºòÂåñ */
        -webkit-tap-highlight-color: rgba(255, 255, 255, 0.2);
        -webkit-touch-callout: none;
        user-select: none;
        touch-action: manipulation;
      }

      .tab-btn.active {
        background: rgba(255, 255, 255, 0.3);
        border-color: white;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .tab-btn:active {
        transform: scale(0.95);
      }

      .source-content {
        display: none;
      }

      .source-content.active {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .input-group {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .video-input {
        flex: 1;
        padding: 12px 15px;
        background: rgba(255, 255, 255, 0.9);
        border: 2px solid rgba(255, 255, 255, 0.5);
        border-radius: 10px;
        font-size: 14px;
        color: #2c3e50;
        outline: none;
        transition: all 0.3s ease;
      }

      .video-input:focus {
        border-color: #ee6c4d;
        box-shadow: 0 0 0 3px rgba(238, 108, 77, 0.2);
      }

      .file-upload-btn {
        padding: 12px 25px;
        background: linear-gradient(135deg, #ee6c4d 0%, #f4a261 100%);
        border: none;
        border-radius: 10px;
        color: white;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        /* iOSËß¶Êë∏‰ºòÂåñ */
        -webkit-tap-highlight-color: rgba(238, 108, 77, 0.3);
        -webkit-touch-callout: none;
        user-select: none;
        touch-action: manipulation;
      }

      .file-upload-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }

      .file-upload-btn:active {
        transform: translateY(0);
      }

      .load-btn {
        padding: 12px 30px;
        background: linear-gradient(135deg, #ee6c4d 0%, #f4a261 100%);
        border: none;
        border-radius: 10px;
        color: white;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        /* iOSËß¶Êë∏‰ºòÂåñ */
        -webkit-tap-highlight-color: rgba(238, 108, 77, 0.3);
        -webkit-touch-callout: none;
        user-select: none;
        touch-action: manipulation;
      }

      .load-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }

      .load-btn:active {
        transform: translateY(0);
      }

      .file-input {
        display: none;
      }

      .current-source {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.8);
        padding: 8px 12px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        word-break: break-all;
      }

      .video-wrapper {
        width: 100%;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      }

      @keyframes slideUp {
        from {
          transform: translateY(50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .close-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.2);
        border: none;
        border-radius: 50%;
        color: white;
        font-size: 24px;
        cursor: pointer;
        z-index: 1001;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
      }

      .close-btn:active {
        transform: scale(0.9);
        background: rgba(255, 255, 255, 0.3);
      }

      .video-container {
        position: relative;
        width: 100%;
        background: #000;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        z-index: 1;
      }

      .video-container:fullscreen {
        z-index: auto;
      }

      .video-container:-webkit-full-screen {
        z-index: auto;
      }

      .video-container:-moz-full-screen {
        z-index: auto;
      }

      .video-container:-ms-fullscreen {
        z-index: auto;
      }

      video {
        width: 100%;
        height: auto;
        display: block;
        max-height: 70vh;
      }

      video:fullscreen {
        max-height: 100vh;
      }

      video:-webkit-full-screen {
        max-height: 100vh;
      }

      video:-moz-full-screen {
        max-height: 100vh;
      }

      video:-ms-fullscreen {
        max-height: 100vh;
      }

      .video-title {
        background: linear-gradient(to bottom, rgba(0, 0, 0, 0.7), transparent);
        color: white;
        padding: 15px 20px;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        font-size: 16px;
        font-weight: 600;
        z-index: 10;
      }

      .play-indicator {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80px;
        height: 80px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 50%;
        display: none;
        align-items: center;
        justify-content: center;
        pointer-events: none;
        animation: fadeOut 0.5s ease;
      }

      .play-indicator.show {
        display: flex;
      }

      @keyframes fadeOut {
        0% {
          opacity: 1;
          transform: translate(-50%, -50%) scale(0.8);
        }
        100% {
          opacity: 0;
          transform: translate(-50%, -50%) scale(1.2);
        }
      }

      .play-indicator::before {
        content: "";
        width: 0;
        height: 0;
        border-style: solid;
        border-width: 15px 0 15px 25px;
        border-color: transparent transparent transparent #ee6c4d;
        margin-left: 5px;
      }

      .loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: none;
      }

      .loading.show {
        display: block;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      @media (max-width: 768px) {
        .modal-container {
          padding: 10px;
        }

        .video-title {
          font-size: 14px;
          padding: 12px 15px;
        }

        .close-btn {
          width: 35px;
          height: 35px;
          font-size: 20px;
        }

        .open-btn {
          padding: 12px 30px;
          font-size: 16px;
        }
      }

      @media (orientation: landscape) and (max-width: 896px) {
        .modal-container {
          padding: 10px;
          max-width: 100%;
        }

        video {
          max-height: 90vh;
        }
      }

      /* Êó•ÂøóÈù¢ÊùøÊ†∑Âºè */
      .log-panel {
        display: flex;
        flex-direction: column;
        width: 100%;
        max-height: 600px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        min-height: 0; /* Èò≤Ê≠¢ÂÜÖÂÆπÊ∫¢Âá∫ */
      }

      .log-panel-container {
        position: relative;
        width: 100%;
        flex: 1;
        min-height: 0;
        display: flex;
        flex-direction: column;
      }

      .log-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 15px;
        flex-shrink: 0; /* Èò≤Ê≠¢headerË¢´ÂéãÁº© */
        border-bottom: 2px solid rgba(255, 255, 255, 0.2);
      }

      .log-title {
        color: white;
        font-size: 18px;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .log-actions {
        display: flex;
        gap: 10px;
      }

      .log-clear-btn {
        padding: 8px 18px;
        background: rgba(255, 71, 87, 0.8);
        border: none;
        border-radius: 8px;
        color: white;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        /* iOSËß¶Êë∏‰ºòÂåñ */
        -webkit-tap-highlight-color: rgba(255, 71, 87, 0.3);
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
        touch-action: manipulation;
      }

      .log-clear-btn:hover {
        background: rgba(255, 71, 87, 0.9);
      }

      .log-clear-btn:active {
        transform: scale(0.95);
        background: rgba(255, 71, 87, 1);
      }

      .log-diagnose-btn,
      .log-copy-btn {
        padding: 8px 18px;
        background: rgba(238, 108, 77, 0.8);
        border: none;
        border-radius: 8px;
        color: white;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        /* iOSËß¶Êë∏‰ºòÂåñ */
        -webkit-tap-highlight-color: rgba(238, 108, 77, 0.3);
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
        touch-action: manipulation;
      }

      .log-diagnose-btn:hover,
      .log-copy-btn:hover {
        background: rgba(238, 108, 77, 0.9);
      }

      .log-diagnose-btn:active,
      .log-copy-btn:active {
        transform: scale(0.95);
        background: rgba(238, 108, 77, 1);
      }

      .log-copy-btn.success {
        background: rgba(42, 157, 143, 0.9);
      }

      .log-tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 12px;
        padding: 10px 2px 8px 2px; /* È°∂ÈÉ®ÂíåÂ∫ïÈÉ®Â¢ûÂä†padding,‰∏∫ËßíÊ†áÁïôÂá∫Á©∫Èó¥ */
        min-height: 48px; /* Á°Æ‰øùÂÆπÂô®ÊúâË∂≥Â§üÈ´òÂ∫¶ÂÆπÁ∫≥ÊåâÈíÆÂíåËßíÊ†á */
        overflow-x: auto;
        overflow-y: visible; /* ÂÖÅËÆ∏ÂûÇÁõ¥Ê∫¢Âá∫ÊòæÁ§∫ËßíÊ†á */
        flex-wrap: nowrap;
        -webkit-overflow-scrolling: touch;
      }

      .log-tabs::-webkit-scrollbar {
        height: 4px;
      }

      .log-tabs::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.1);
        border-radius: 2px;
      }

      .log-tabs::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 2px;
      }

      .log-tab-btn {
        position: relative; /* ‰∏∫ËßíÊ†áÊèê‰æõÂÆö‰ΩçÂü∫ÂáÜ */
        flex-shrink: 0;
        padding: 6px 14px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 6px;
        color: rgba(255, 255, 255, 0.8);
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        white-space: nowrap;
        overflow: visible; /* ÂÖÅËÆ∏ËßíÊ†áÊ∫¢Âá∫ÊòæÁ§∫ */
        /* iOSËß¶Êë∏‰ºòÂåñ */
        -webkit-tap-highlight-color: rgba(255, 255, 255, 0.1);
        -webkit-touch-callout: none;
        user-select: none;
        touch-action: manipulation;
      }

      .log-tab-btn:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.3);
      }

      .log-tab-btn:active {
        transform: scale(0.95);
      }

      .log-tab-btn.active {
        background: rgba(255, 255, 255, 0.25);
        border-color: rgba(255, 255, 255, 0.4);
        color: white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      }

      .log-count {
        position: absolute;
        top: -6px;
        right: -6px;
        min-width: 18px;
        height: 18px;
        padding: 0 5px;
        background: linear-gradient(135deg, #ff4757 0%, #ff6348 100%);
        border: 1.5px solid rgba(255, 255, 255, 0.9);
        border-radius: 9px;
        font-size: 10px;
        font-weight: 700;
        line-height: 18px;
        text-align: center;
        color: white;
        box-shadow: 0 2px 8px rgba(255, 71, 87, 0.4);
      }

      .log-tab-btn.active .log-count {
        background: linear-gradient(135deg, #ee6c4d 0%, #f4a261 100%);
        border-color: rgba(255, 255, 255, 1);
        transform: scale(1.08);
        box-shadow: 0 3px 10px rgba(238, 108, 77, 0.5);
      }

      .log-tab-text {
        display: inline-block;
        position: relative;
        z-index: 1;
      }

      .log-content {
        flex: 1;
        overflow-y: auto;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        padding: 15px;
        max-height: 450px;
        min-height: 0; /* Èò≤Ê≠¢flexÂ≠êÂÖÉÁ¥†Ê∫¢Âá∫ */
      }

      .log-item {
        padding: 10px 12px;
        margin-bottom: 8px;
        background: rgba(255, 255, 255, 0.05);
        border-left: 3px solid;
        border-radius: 6px;
        color: white;
        font-size: 13px;
        line-height: 1.6;
        animation: logSlideIn 0.3s ease;
        white-space: normal;
        word-break: break-all;
      }

      @keyframes logSlideIn {
        from {
          opacity: 0;
          transform: translateX(-20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .log-item.info {
        border-color: #98c1d9;
      }

      .log-item.success {
        border-color: #2a9d8f;
      }

      .log-item.warning {
        border-color: #f39c12;
      }

      .log-item.error {
        border-color: #e74c3c;
      }

      .log-time {
        color: rgba(255, 255, 255, 0.7);
        font-size: 12px;
        margin-right: 10px;
        font-weight: 600;
        font-family: "Courier New", monospace;
        background: rgba(0, 0, 0, 0.3);
        padding: 3px 8px;
        border-radius: 4px;
        display: inline-block;
      }

      .log-type {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 600;
        margin-right: 8px;
      }

      .log-type.info {
        background: #98c1d9;
      }

      .log-type.success {
        background: #2a9d8f;
      }

      .log-type.warning {
        background: #f39c12;
      }

      .log-type.error {
        background: #e74c3c;
      }

      .log-empty {
        text-align: center;
        color: rgba(255, 255, 255, 0.4);
        padding: 40px 20px;
        font-size: 14px;
      }

      .log-content::-webkit-scrollbar {
        width: 8px;
      }

      .log-content::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 4px;
      }

      .log-content::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.3);
        border-radius: 4px;
      }

      .log-content::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.5);
      }

      @media (max-width: 768px) {
        body {
          padding: 15px;
        }

        .main-container {
          gap: 16px;
        }

        .title {
          font-size: 22px;
          margin: 15px 0;
        }

        .video-source-panel {
          padding: 16px;
        }

        .source-tabs {
          flex-direction: column;
          gap: 8px;
        }

        .tab-btn {
          padding: 12px 20px;
          font-size: 13px;
        }

        .input-group {
          flex-direction: column;
          gap: 8px;
        }

        .video-input {
          padding: 10px 12px;
          font-size: 13px;
        }

        .load-btn,
        .file-upload-btn {
          width: 100%;
          padding: 10px 20px;
          font-size: 13px;
        }

        .current-source {
          font-size: 12px;
          padding: 6px 10px;
        }

        .video-wrapper {
          padding: 16px;
        }

        .video-title {
          font-size: 14px;
          padding: 12px 15px;
        }

        .log-panel {
          max-height: 500px;
          padding: 15px;
        }

        .log-header {
          margin-bottom: 12px;
          padding-bottom: 12px;
        }

        .log-title {
          font-size: 16px;
        }

        .log-actions {
          gap: 8px;
        }

        .log-clear-btn,
        .log-diagnose-btn,
        .log-copy-btn {
          padding: 7px 14px;
          font-size: 12px;
        }

        .log-tabs {
          gap: 6px;
          padding: 8px 2px 6px 2px;
          min-height: 42px;
        }

        .log-tab-btn {
          padding: 6px 12px;
          font-size: 11px;
        }

        .log-count {
          top: -8px;
          right: -8px;
          min-width: 16px;
          height: 16px;
          font-size: 9px;
          line-height: 16px;
          padding: 0 4px;
          border-width: 1.5px;
        }

        .log-content {
          max-height: 350px;
          padding: 12px;
        }

        .log-item {
          font-size: 12px;
          padding: 8px 10px;
          margin-bottom: 6px;
        }

        .log-time {
          font-size: 11px;
          padding: 2px 6px;
        }

        .log-type {
          font-size: 10px;
          padding: 2px 6px;
        }
      }

      @media (max-width: 480px) {
        body {
          padding: 10px;
        }

        .main-container {
          gap: 12px;
        }

        .title {
          font-size: 20px;
          margin: 10px 0;
        }

        .video-source-panel {
          padding: 12px;
        }

        .source-tabs {
          gap: 6px;
        }

        .tab-btn {
          padding: 10px 16px;
          font-size: 12px;
        }

        .source-content {
          gap: 8px;
        }

        .video-input {
          padding: 9px 10px;
          font-size: 12px;
        }

        .load-btn,
        .file-upload-btn {
          padding: 9px 16px;
          font-size: 12px;
        }

        .current-source {
          font-size: 11px;
          padding: 5px 8px;
        }

        .video-wrapper {
          padding: 12px;
        }

        .video-title {
          font-size: 13px;
          padding: 10px 12px;
        }

        .log-panel {
          max-height: 450px;
          padding: 12px;
        }

        .log-header {
          flex-wrap: wrap;
          gap: 8px;
          margin-bottom: 10px;
          padding-bottom: 10px;
        }

        .log-title {
          font-size: 14px;
          flex: 1 1 100%;
        }

        .log-actions {
          gap: 6px;
          width: 100%;
          justify-content: flex-end;
        }

        .log-clear-btn,
        .log-diagnose-btn,
        .log-copy-btn {
          padding: 6px 12px;
          font-size: 11px;
          flex: 1;
        }

        .log-tabs {
          gap: 4px;
          padding: 6px 2px 4px 2px;
          min-height: 38px;
        }

        .log-tab-btn {
          padding: 5px 10px;
          font-size: 10px;
        }

        .log-count {
          top: -6px;
          right: -6px;
          min-width: 14px;
          height: 14px;
          font-size: 8px;
          line-height: 14px;
          padding: 0 3px;
          border-width: 1px;
        }

        .log-content {
          max-height: 300px;
          padding: 10px;
        }

        .log-item {
          font-size: 11px;
          padding: 6px 8px;
          margin-bottom: 5px;
        }

        .log-time {
          font-size: 10px;
          padding: 2px 5px;
          margin-right: 6px;
        }

        .log-type {
          font-size: 9px;
          padding: 1px 5px;
          margin-right: 6px;
        }

        .log-empty {
          padding: 30px 15px;
          font-size: 13px;
        }
      }

      /* ‰∏ªÈ¢òËÆæÁΩÆÊåâÈíÆ */
      .theme-toggle-btn {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 56px;
        height: 56px;
        background: rgba(255, 255, 255, 0.95);
        border: none;
        border-radius: 50%;
        font-size: 26px;
        cursor: pointer;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
        z-index: 9998;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .theme-toggle-btn:hover {
        transform: scale(1.1) rotate(15deg);
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
      }

      .theme-toggle-btn:active {
        transform: scale(0.95);
      }

      @media (max-width: 768px) {
        .theme-toggle-btn {
          width: 48px;
          height: 48px;
          font-size: 22px;
          bottom: 20px;
          right: 20px;
        }
      }
    </style>
  </head>
  <body>
    <!-- ‰∏ªÈ¢òËÆæÁΩÆÊåâÈíÆ -->
    <button
      class="theme-toggle-btn"
      onclick="openThemeSelector()"
      title="‰∏ªÈ¢òËÆæÁΩÆ"
    >
      üé®
    </button>

    <a href="../../index.html" class="back-home-btn">ËøîÂõûÈ¶ñÈ°µ</a>
    <div class="main-container">
      <h1 class="title">üìπ ËßÜÈ¢ëÊí≠ÊîæËØäÊñ≠</h1>

      <div class="video-source-panel">
        <div class="source-tabs">
          <button class="tab-btn active" data-tab="url">üåê Âú®Á∫øÂú∞ÂùÄ</button>
          <button class="tab-btn" data-tab="local">üìÅ Êú¨Âú∞Êñá‰ª∂</button>
        </div>

        <div class="source-content active" id="urlContent">
          <div class="input-group">
            <input
              type="text"
              class="video-input"
              id="videoUrlInput"
              placeholder="ËæìÂÖ•ËßÜÈ¢ëURLÂú∞ÂùÄ (ÊîØÊåÅ mp4, webm, ogg Á≠âÊ†ºÂºè)"
            />
            <button class="load-btn" id="loadUrlBtn">Âä†ËΩΩ</button>
          </div>
          <div class="current-source" id="currentUrlSource">ÂΩìÂâç:</div>
        </div>

        <div class="source-content" id="localContent">
          <div class="input-group">
            <input
              type="file"
              class="file-input"
              id="fileInput"
              accept="video/mp4,video/webm,video/ogg,video/quicktime,video/x-msvideo,video/x-matroska,.mp4,.webm,.ogg,.mov,.avi,.mkv,.mpeg,.mpg,.3gp,.flv,.m4v"
            />
            <button class="file-upload-btn" id="uploadBtn">
              üì§ ÈÄâÊã©Êú¨Âú∞ËßÜÈ¢ë
            </button>
          </div>
          <div class="current-source" id="currentLocalSource">Êú™ÈÄâÊã©Êñá‰ª∂</div>
        </div>
      </div>

      <div class="video-wrapper">
        <div class="video-container">
          <div class="video-title"></div>

          <div class="play-indicator" id="playIndicator"></div>

          <div class="loading" id="loading">
            <div class="spinner"></div>
          </div>

          <video
            id="videoPlayer"
            src=""
            controls
            muted
            playsinline
            preload="metadata"
          ></video>
        </div>
      </div>

      <div class="log-panel" id="logPanel">
        <div class="log-panel-container">
          <div class="log-header">
            <!-- <div class="log-title">
              <span>üìã</span>
              <span>Êó•Âøó</span>
            </div> -->
            <div class="log-actions">
              <button class="log-diagnose-btn" id="logDiagnoseBtn">
                üîç ËØäÊñ≠
              </button>
              <button class="log-copy-btn" id="logCopyBtn">üìã Â§çÂà∂</button>
              <button class="log-clear-btn" id="logClearBtn">Ê∏ÖÁ©∫Êó•Âøó</button>
            </div>
          </div>

          <div class="log-tabs">
            <button class="log-tab-btn active" data-log-type="all">
              <span class="log-tab-text">ÂÖ®ÈÉ®</span
              ><span class="log-count" id="countAll">0</span>
            </button>
            <button class="log-tab-btn" data-log-type="info">
              <span class="log-tab-text">‰ø°ÊÅØ</span
              ><span class="log-count" id="countInfo">0</span>
            </button>
            <button class="log-tab-btn" data-log-type="success">
              <span class="log-tab-text">ÊàêÂäü</span
              ><span class="log-count" id="countSuccess">0</span>
            </button>
            <button class="log-tab-btn" data-log-type="warning">
              <span class="log-tab-text">Ë≠¶Âëä</span
              ><span class="log-count" id="countWarning">0</span>
            </button>
            <button class="log-tab-btn" data-log-type="error">
              <span class="log-tab-text">ÈîôËØØ</span
              ><span class="log-count" id="countError">0</span>
            </button>
          </div>

          <div class="log-content" id="logContent">
            <div class="log-empty">ÊöÇÊó†Êó•ÂøóËÆ∞ÂΩï</div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const videoPlayer = document.getElementById("videoPlayer");
      const playIndicator = document.getElementById("playIndicator");
      const loading = document.getElementById("loading");
      const logPanel = document.getElementById("logPanel");
      const logClearBtn = document.getElementById("logClearBtn");
      const logDiagnoseBtn = document.getElementById("logDiagnoseBtn");
      const logCopyBtn = document.getElementById("logCopyBtn");
      const logContent = document.getElementById("logContent");
      const videoUrlInput = document.getElementById("videoUrlInput");
      const loadUrlBtn = document.getElementById("loadUrlBtn");
      const fileInput = document.getElementById("fileInput");
      const uploadBtn = document.getElementById("uploadBtn");
      const currentUrlSource = document.getElementById("currentUrlSource");
      const currentLocalSource = document.getElementById("currentLocalSource");
      const videoTitle = document.querySelector(".video-title");

      let videoLogs = [];
      let currentVideoFile = null;
      let lastRenderedLogCount = 0; // ËÆ∞ÂΩï‰∏äÊ¨°Ê∏≤ÊüìÁöÑÊó•ÂøóÊï∞Èáè
      let autoScroll = true; // ÊòØÂê¶Ëá™Âä®ÊªöÂä®Âà∞Â∫ïÈÉ®
      let currentLogFilter = "all"; // ÂΩìÂâçÊó•ÂøóËøáÊª§Á±ªÂûã

      // ËäÇÊµÅÂèòÈáè
      let progressLogThrottle = null;
      let lastProgressLog = 0;

      // Êó•ÂøóÁ±ªÂûãÁªüËÆ°
      let logCounts = {
        all: 0,
        info: 0,
        success: 0,
        warning: 0,
        error: 0
      };

      // ËßÜÈ¢ëÊ∫êTabÂàáÊç¢ÂäüËÉΩ
      const tabBtns = document.querySelectorAll(".tab-btn");
      const sourceContents = document.querySelectorAll(".source-content");

      // Êó•ÂøóÁ±ªÂûãTabÂàáÊç¢ÂäüËÉΩ
      const logTabBtns = document.querySelectorAll(".log-tab-btn");
      const countElements = {
        all: document.getElementById("countAll"),
        info: document.getElementById("countInfo"),
        success: document.getElementById("countSuccess"),
        warning: document.getElementById("countWarning"),
        error: document.getElementById("countError")
      };

      // ËßÜÈ¢ëÊ∫êTabÂàáÊç¢
      tabBtns.forEach((btn) => {
        btn.addEventListener("click", function () {
          const tab = this.getAttribute("data-tab");

          tabBtns.forEach((b) => b.classList.remove("active"));
          sourceContents.forEach((c) => c.classList.remove("active"));

          this.classList.add("active");
          if (tab === "url") {
            document.getElementById("urlContent").classList.add("active");
          } else {
            document.getElementById("localContent").classList.add("active");
          }

          addLog(
            `ÂàáÊç¢Âà∞${tab === "url" ? "Âú®Á∫øÂú∞ÂùÄ" : "Êú¨Âú∞Êñá‰ª∂"}Ê®°Âºè`,
            "info"
          );
        });
      });

      // Êó•ÂøóÁ±ªÂûãTabÂàáÊç¢
      logTabBtns.forEach((btn) => {
        btn.addEventListener("click", function () {
          const logType = this.getAttribute("data-log-type");

          logTabBtns.forEach((b) => b.classList.remove("active"));
          this.classList.add("active");

          currentLogFilter = logType;

          // ÈáçÊñ∞Ê∏≤ÊüìÊó•ÂøóÂàóË°®
          lastRenderedLogCount = 0;
          logContent.innerHTML = "";
          renderLogs();
        });
      });

      // Êõ¥Êñ∞Êó•ÂøóËÆ°Êï∞ÊòæÁ§∫
      function updateLogCounts() {
        Object.keys(logCounts).forEach((type) => {
          if (countElements[type]) {
            const count = logCounts[type];
            countElements[type].textContent = count > 99 ? "99+" : count;
          }
        });
      }

      // Âä†ËΩΩÂú®Á∫øËßÜÈ¢ë
      loadUrlBtn.addEventListener("click", function () {
        const url = videoUrlInput.value.trim();

        if (!url) {
          alert("ËØ∑ËæìÂÖ•ËßÜÈ¢ëURLÂú∞ÂùÄ");
          return;
        }

        addLog(`ÂáÜÂ§áÂä†ËΩΩÂú®Á∫øËßÜÈ¢ë: ${url}`, "info");

        // ÈáäÊîæ‰πãÂâçÁöÑÊú¨Âú∞Êñá‰ª∂URL
        if (currentVideoFile) {
          URL.revokeObjectURL(currentVideoFile);
          currentVideoFile = null;
          addLog("Â∑≤ÈáäÊîæ‰πãÂâçÁöÑÊú¨Âú∞Êñá‰ª∂URL", "info");
        }

        // ÂÖàÈáçÁΩÆËßÜÈ¢ëÂÖÉÁ¥†
        videoPlayer.pause();
        videoPlayer.removeAttribute("src");
        videoPlayer.load();

        addLog("ËßÜÈ¢ëÂÖÉÁ¥†Â∑≤ÈáçÁΩÆ,ÂáÜÂ§áËÆæÁΩÆÊñ∞Ê∫ê", "info");

        // ËÆæÁΩÆÊñ∞Ê∫ê
        videoPlayer.src = url;
        currentUrlSource.textContent = `ÂΩìÂâç: ${url}`;
        videoTitle.textContent = "Âú®Á∫øËßÜÈ¢ë";

        addLog("Êñ∞ËßÜÈ¢ëÊ∫êÂ∑≤ËÆæÁΩÆ,ÂºÄÂßãÂä†ËΩΩ...", "info");

        // Â∞ùËØïÂä†ËΩΩ
        videoPlayer.load();

        // Âª∂ËøüÊ£ÄÊü•Âä†ËΩΩÁä∂ÊÄÅ
        setTimeout(function () {
          addLog(
            `3ÁßíÂêéÁä∂ÊÄÅÊ£ÄÊü• - ÁΩëÁªúÁä∂ÊÄÅ: ${videoPlayer.networkState}, Â∞±Áª™Áä∂ÊÄÅ: ${videoPlayer.readyState}`,
            "info"
          );
          if (videoPlayer.networkState === 3) {
            addLog("Ê£ÄÊµãÂà∞ÁΩëÁªúÈîôËØØÁä∂ÊÄÅ,ÂèØËÉΩÊòØCORSÊàñÁΩëÁªúËøûÊé•ÈóÆÈ¢ò", "error");
          }
        }, 3000);
      });

      // ÊîØÊåÅÂõûËΩ¶ÈîÆÂä†ËΩΩ
      videoUrlInput.addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
          loadUrlBtn.click();
        }
      });

      // ÈÄâÊã©Êú¨Âú∞Êñá‰ª∂
      uploadBtn.addEventListener("click", function () {
        fileInput.click();
      });

      fileInput.addEventListener("change", function (e) {
        const file = e.target.files[0];

        if (!file) {
          return;
        }

        // ÊîØÊåÅÁöÑËßÜÈ¢ëÊ†ºÂºèÂàóË°®
        const supportedVideoTypes = [
          "video/mp4",
          "video/webm",
          "video/ogg",
          "video/quicktime",
          "video/x-msvideo",
          "video/x-matroska",
          "video/mpeg",
          "video/3gpp",
          "video/x-flv"
        ];

        // ÊîØÊåÅÁöÑËßÜÈ¢ëÊâ©Â±ïÂêç
        const supportedExtensions = [
          ".mp4",
          ".webm",
          ".ogg",
          ".mov",
          ".avi",
          ".mkv",
          ".mpeg",
          ".mpg",
          ".3gp",
          ".flv",
          ".m4v"
        ];

        // Ëé∑ÂèñÊñá‰ª∂Êâ©Â±ïÂêç
        const fileName = file.name.toLowerCase();
        const fileExtension = fileName.substring(fileName.lastIndexOf("."));

        // ÂèåÈáçÈ™åËØÅ:Ê£ÄÊü•MIMEÁ±ªÂûãÂíåÊñá‰ª∂Êâ©Â±ïÂêç
        const isVideoType =
          file.type.startsWith("video/") ||
          supportedVideoTypes.includes(file.type);
        const hasVideoExtension = supportedExtensions.includes(fileExtension);

        if (!isVideoType && !hasVideoExtension) {
          alert(
            `ËØ∑ÈÄâÊã©ËßÜÈ¢ëÊñá‰ª∂!\n\nÊîØÊåÅÁöÑÊ†ºÂºè: ${supportedExtensions.join(", ")}`
          );
          fileInput.value = ""; // Ê∏ÖÁ©∫Êñá‰ª∂ÈÄâÊã©
          addLog(
            `Êñá‰ª∂Á±ªÂûãÈîôËØØ: ${file.name} (${file.type || "Êú™Áü•Á±ªÂûã"})`,
            "error"
          );
          return;
        }

        // Ê£ÄÊü•Êñá‰ª∂Â§ßÂ∞è (Âª∫ËÆÆ‰∏çË∂ÖËøá500MB)
        const maxSize = 500 * 1024 * 1024; // 500MB
        if (file.size > maxSize) {
          const sizeMB = (file.size / 1024 / 1024).toFixed(2);
          if (
            !confirm(
              `Êñá‰ª∂ËæÉÂ§ß (${sizeMB} MB),Âä†ËΩΩÂèØËÉΩÈúÄË¶ÅËæÉÈïøÊó∂Èó¥„ÄÇ\nÊòØÂê¶ÁªßÁª≠?`
            )
          ) {
            fileInput.value = "";
            return;
          }
        }

        // ÈáäÊîæ‰πãÂâçÁöÑURL
        if (currentVideoFile) {
          URL.revokeObjectURL(currentVideoFile);
        }

        // ÂàõÂª∫Êú¨Âú∞Êñá‰ª∂URL
        currentVideoFile = URL.createObjectURL(file);
        videoPlayer.src = currentVideoFile;
        videoPlayer.load();

        const fileSize = (file.size / 1024 / 1024).toFixed(2);
        currentLocalSource.textContent = `${file.name} (${fileSize} MB)`;
        videoTitle.textContent = file.name;

        addLog(
          `Âä†ËΩΩÊú¨Âú∞ËßÜÈ¢ë: ${file.name} (${fileSize} MB, ${
            file.type || "Êú™Áü•Á±ªÂûã"
          })`,
          "success"
        );
      });

      function addLog(message, type = "info") {
        const now = new Date();
        // Ê†ºÂºèÂåñÊó∂Èó¥‰∏∫: 2025-01-10 14:32:15
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, "0");
        const day = String(now.getDate()).padStart(2, "0");
        const hours = String(now.getHours()).padStart(2, "0");
        const minutes = String(now.getMinutes()).padStart(2, "0");
        const seconds = String(now.getSeconds()).padStart(2, "0");
        const time = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;

        videoLogs.push({
          time,
          message,
          type,
          timestamp: now.getTime()
        });

        // Êõ¥Êñ∞ÁªüËÆ°
        logCounts.all++;
        if (logCounts[type] !== undefined) {
          logCounts[type]++;
        }
        updateLogCounts();

        renderLogs();
      }

      function renderLogs() {
        // ËøáÊª§Êó•Âøó
        const filteredLogs =
          currentLogFilter === "all"
            ? videoLogs
            : videoLogs.filter((log) => log.type === currentLogFilter);

        if (filteredLogs.length === 0) {
          logContent.innerHTML = '<div class="log-empty">ÊöÇÊó†Ê≠§Á±ªÂûãÊó•Âøó</div>';
          lastRenderedLogCount = 0;
          return;
        }

        // Â¢ûÈáèÊ∏≤Êüì:‰ªÖÊ∑ªÂä†Êñ∞Êó•Âøó,ÈÅøÂÖçÂÖ®ÈáèÈáçÁªò
        const newLogsCount = filteredLogs.length - lastRenderedLogCount;

        if (newLogsCount > 0) {
          // È¶ñÊ¨°Ê∏≤ÊüìÊàñÂàáÊç¢ËøáÊª§Âêé
          if (lastRenderedLogCount === 0) {
            const emptyDiv = logContent.querySelector(".log-empty");
            if (emptyDiv) {
              emptyDiv.remove();
            }
          }

          // ‰ªÖÊ∏≤ÊüìÊñ∞Â¢ûÁöÑÊó•Âøó
          const fragment = document.createDocumentFragment();
          const newLogs = filteredLogs.slice(lastRenderedLogCount);

          newLogs.forEach((log) => {
            const logItem = document.createElement("div");
            logItem.className = `log-item ${log.type}`;
            logItem.setAttribute("data-log-type", log.type);
            logItem.innerHTML = `
              <span class="log-time">${log.time}</span>
              <span class="log-type ${
                log.type
              }">${log.type.toUpperCase()}</span>
              <span class="log-message">${log.message}</span>
            `;
            fragment.appendChild(logItem);
          });

          logContent.appendChild(fragment);
          lastRenderedLogCount = filteredLogs.length;

          // Âè™ÊúâÂú®Ëá™Âä®ÊªöÂä®Ê®°Âºè‰∏ãÊâçÊªöÂä®Âà∞Â∫ïÈÉ®
          if (autoScroll) {
            logContent.scrollTop = logContent.scrollHeight;
          }
        }
      }

      function clearLogs() {
        videoLogs = [];
        lastRenderedLogCount = 0;

        // ÈáçÁΩÆËÆ°Êï∞
        logCounts = {
          all: 0,
          info: 0,
          success: 0,
          warning: 0,
          error: 0
        };
        updateLogCounts();

        renderLogs();
      }

      // ÁõëÂê¨Áî®Êà∑ÊªöÂä®,Âà§Êñ≠ÊòØÂê¶Á¶ÅÁî®Ëá™Âä®ÊªöÂä®
      logContent.addEventListener("scroll", function () {
        const isAtBottom =
          logContent.scrollHeight -
            logContent.scrollTop -
            logContent.clientHeight <
          50;
        autoScroll = isAtBottom;
      });

      // Ê∏ÖÁ©∫Êó•ÂøóÊåâÈíÆ
      function handleClearLogs(e) {
        if (e) {
          e.preventDefault();
          e.stopPropagation();
        }
        clearLogs();
        addLog("Áî®Êà∑Ê∏ÖÁ©∫‰∫ÜÊó•Âøó", "info");
      }

      logClearBtn.addEventListener("click", handleClearLogs);
      logClearBtn.addEventListener("touchend", function (e) {
        e.preventDefault();
        handleClearLogs(e);
      });

      // ËØäÊñ≠ÊåâÈíÆ - ÂÆûÊó∂ËæìÂá∫ÂΩìÂâçËßÜÈ¢ëÁä∂ÊÄÅ
      function handleDiagnose(e) {
        if (e) {
          e.preventDefault();
          e.stopPropagation();
        }
        addLog("========== ÂºÄÂßãËØäÊñ≠ ==========", "info");

        // ËÆæÂ§á‰ø°ÊÅØ
        const userAgent = navigator.userAgent;
        const isIOS = /iPad|iPhone|iPod/.test(userAgent);
        const isSafari = /Safari/.test(userAgent) && !/Chrome/.test(userAgent);
        const isWeChat = /MicroMessenger/.test(userAgent);

        addLog(`ÂΩìÂâçËÆæÂ§á: ${isIOS ? "iOS" : "ÂÖ∂‰ªñ"}`, "info");
        addLog(
          `ÂΩìÂâçÊµèËßàÂô®: ${isSafari ? "Safari" : isWeChat ? "ÂæÆ‰ø°" : "ÂÖ∂‰ªñ"}`,
          "info"
        );

        // ËßÜÈ¢ëÂÖÉÁ¥†Áä∂ÊÄÅ
        addLog(`ËßÜÈ¢ëÊ∫ê: ${videoPlayer.src || "Êú™ËÆæÁΩÆ"}`, "info");
        addLog(
          `ËßÜÈ¢ëÊ∫êÈïøÂ∫¶: ${videoPlayer.src ? videoPlayer.src.length : 0}Â≠óÁ¨¶`,
          "info"
        );
        addLog(
          `Â∞±Áª™Áä∂ÊÄÅ: ${videoPlayer.readyState} (0=Êú™Âä†ËΩΩ,1=ÂÖÉÊï∞ÊçÆ,2=ÂΩìÂâçÂ∏ß,3=Êú™Êù•Êï∞ÊçÆ,4=Ë∂≥Â§ü)`,
          videoPlayer.readyState >= 2 ? "success" : "warning"
        );
        addLog(
          `ÁΩëÁªúÁä∂ÊÄÅ: ${videoPlayer.networkState} (0=Á©∫Èó≤,1=Âä†ËΩΩ‰∏≠,2=Êó†Ê∫ê,3=ÁΩëÁªúÈîôËØØ)`,
          videoPlayer.networkState === 3 ? "error" : "info"
        );
        addLog(`ÊòØÂê¶ÊöÇÂÅú: ${videoPlayer.paused}`, "info");
        addLog(`ÂΩìÂâçÊó∂Èó¥: ${videoPlayer.currentTime.toFixed(2)}Áßí`, "info");
        addLog(
          `ÊÄªÊó∂Èïø: ${
            isNaN(videoPlayer.duration)
              ? "Êú™Áü•"
              : videoPlayer.duration.toFixed(2) + "Áßí"
          }`,
          "info"
        );
        addLog(
          `ËßÜÈ¢ëÂàÜËæ®Áéá: ${videoPlayer.videoWidth}x${videoPlayer.videoHeight}`,
          videoPlayer.videoWidth > 0 ? "success" : "warning"
        );

        // ÁºìÂÜ≤‰ø°ÊÅØ
        if (videoPlayer.buffered.length > 0) {
          const bufferedEnd = videoPlayer.buffered.end(
            videoPlayer.buffered.length - 1
          );
          addLog(`Â∑≤ÁºìÂÜ≤: ${bufferedEnd.toFixed(2)}Áßí`, "success");
        } else {
          addLog(`Â∑≤ÁºìÂÜ≤: 0Áßí`, "warning");
        }

        // ÈîôËØØ‰ø°ÊÅØ
        if (videoPlayer.error) {
          const errorCode = videoPlayer.error.code;
          const errorNames = [
            "",
            "ABORTED",
            "NETWORK",
            "DECODE",
            "SRC_NOT_SUPPORTED"
          ];
          addLog(
            `ÈîôËØØ‰ª£Á†Å: ${errorCode} (${errorNames[errorCode] || "Êú™Áü•"})`,
            "error"
          );
          addLog(`ÈîôËØØÊ∂àÊÅØ: ${videoPlayer.error.message || "Êó†"}`, "error");
        } else {
          addLog(`Êó†ÈîôËØØ`, "success");
        }

        // ÁΩëÁªú‰ø°ÊÅØ
        if (
          navigator.connection ||
          navigator.mozConnection ||
          navigator.webkitConnection
        ) {
          const connection =
            navigator.connection ||
            navigator.mozConnection ||
            navigator.webkitConnection;
          addLog(
            `ÁΩëÁªúÁ±ªÂûã: ${
              connection.effectiveType || connection.type || "Êú™Áü•"
            }`,
            "info"
          );
          if (connection.downlink) {
            addLog(`‰∏ãËΩΩÈÄüÂ∫¶: ${connection.downlink} Mbps`, "info");
          }
        }

        // ËßÜÈ¢ëÊ†ºÂºèÊîØÊåÅ
        const mp4Support = videoPlayer.canPlayType(
          'video/mp4; codecs="avc1.42E01E, mp4a.40.2"'
        );
        addLog(
          `MP4ÊîØÊåÅ: ${mp4Support || "‰∏çÊîØÊåÅ"}`,
          mp4Support ? "success" : "error"
        );

        // Âª∫ËÆÆ
        if (videoPlayer.readyState === 0) {
          addLog("‚ö†Ô∏è Âª∫ËÆÆ: ËßÜÈ¢ëÊú™Âä†ËΩΩ,Â∞ùËØïÁÇπÂáªËßÜÈ¢ëÊàñÂà∑Êñ∞È°µÈù¢", "warning");
        }
        if (videoPlayer.networkState === 3) {
          addLog("‚ö†Ô∏è Âª∫ËÆÆ: ÁΩëÁªúÈîôËØØ,Ê£ÄÊü•ËßÜÈ¢ëURLÊòØÂê¶ÂèØËÆøÈóÆ", "error");
        }
        if (isIOS && videoPlayer.paused && videoPlayer.readyState === 0) {
          addLog("‚ö†Ô∏è iOSÊèêÁ§∫: ÁÇπÂáªËßÜÈ¢ëÊí≠ÊîæÊåâÈíÆÊøÄÊ¥ªÂä†ËΩΩ", "warning");
        }

        addLog("========== ËØäÊñ≠ÂÆåÊàê ==========", "info");
      }

      logDiagnoseBtn.addEventListener("click", handleDiagnose);
      logDiagnoseBtn.addEventListener("touchend", function (e) {
        e.preventDefault();
        handleDiagnose(e);
      });

      // ‰∏ÄÈîÆÂ§çÂà∂Êó•ÂøóÂäüËÉΩ
      function handleCopyLogs(e) {
        if (e) {
          e.preventDefault();
          e.stopPropagation();
        }

        if (videoLogs.length === 0) {
          alert("ÊöÇÊó†Êó•ÂøóÂèØÂ§çÂà∂");
          return;
        }

        // Ê†ºÂºèÂåñÊó•Âøó‰∏∫ÊñáÊú¨
        const logsText = videoLogs
          .map(
            (log) => `[${log.time}] [${log.type.toUpperCase()}] ${log.message}`
          )
          .join("\n");

        // Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard
            .writeText(logsText)
            .then(() => {
              // ÊòæÁ§∫ÊàêÂäüÊèêÁ§∫
              logCopyBtn.textContent = "‚úÖ Â∑≤Â§çÂà∂";
              logCopyBtn.classList.add("success");

              setTimeout(() => {
                logCopyBtn.textContent = "üìã Â§çÂà∂";
                logCopyBtn.classList.remove("success");
              }, 2000);

              addLog(`Â∑≤Â§çÂà∂ ${videoLogs.length} Êù°Êó•ÂøóÂà∞Ââ™Ë¥¥Êùø`, "success");
            })
            .catch((err) => {
              console.error("Â§çÂà∂Â§±Ë¥•:", err);
              alert("Â§çÂà∂Â§±Ë¥•,ËØ∑ÊâãÂä®ÈÄâÊã©ÊñáÊú¨Â§çÂà∂");
            });
        } else {
          // ÈôçÁ∫ßÊñπÊ°à:‰ΩøÁî®textarea
          const textarea = document.createElement("textarea");
          textarea.value = logsText;
          textarea.style.position = "fixed";
          textarea.style.opacity = "0";
          document.body.appendChild(textarea);
          textarea.select();

          try {
            const successful = document.execCommand("copy");
            if (successful) {
              logCopyBtn.textContent = "‚úÖ Â∑≤Â§çÂà∂";
              logCopyBtn.classList.add("success");

              setTimeout(() => {
                logCopyBtn.textContent = "üìã Â§çÂà∂";
                logCopyBtn.classList.remove("success");
              }, 2000);

              addLog(`Â∑≤Â§çÂà∂ ${videoLogs.length} Êù°Êó•ÂøóÂà∞Ââ™Ë¥¥Êùø`, "success");
            } else {
              alert("Â§çÂà∂Â§±Ë¥•,ËØ∑ÊâãÂä®ÈÄâÊã©ÊñáÊú¨Â§çÂà∂");
            }
          } catch (err) {
            console.error("Â§çÂà∂Â§±Ë¥•:", err);
            alert("Â§çÂà∂Â§±Ë¥•,ËØ∑ÊâãÂä®ÈÄâÊã©ÊñáÊú¨Â§çÂà∂");
          } finally {
            document.body.removeChild(textarea);
          }
        }
      }

      logCopyBtn.addEventListener("click", handleCopyLogs);
      logCopyBtn.addEventListener("touchend", function (e) {
        e.preventDefault();
        handleCopyLogs(e);
      });

      videoPlayer.addEventListener("loadstart", function () {
        console.log("ËßÜÈ¢ëÂºÄÂßãÂä†ËΩΩ");
        addLog("ËßÜÈ¢ëÂºÄÂßãÂä†ËΩΩ", "info");
        loading.classList.add("show");
      });

      videoPlayer.addEventListener("canplay", function () {
        console.log("ËßÜÈ¢ëÂèØ‰ª•Êí≠Êîæ");
        addLog("ËßÜÈ¢ëÂ∑≤ÂáÜÂ§áÂ∞±Áª™,ÂèØ‰ª•Êí≠Êîæ", "success");
        loading.classList.remove("show");
      });

      videoPlayer.addEventListener("play", function () {
        console.log("ËßÜÈ¢ëÂºÄÂßãÊí≠Êîæ");
        const currentTime = Math.floor(videoPlayer.currentTime);
        addLog(`ËßÜÈ¢ëÂºÄÂßãÊí≠Êîæ (‰ΩçÁΩÆ: ${currentTime}Áßí)`, "success");
        showPlayIndicator();
      });

      videoPlayer.addEventListener("pause", function () {
        console.log("ËßÜÈ¢ëÂ∑≤ÊöÇÂÅú");
        const currentTime = Math.floor(videoPlayer.currentTime);
        addLog(`ËßÜÈ¢ëÂ∑≤ÊöÇÂÅú (‰ΩçÁΩÆ: ${currentTime}Áßí)`, "warning");
      });

      videoPlayer.addEventListener("ended", function () {
        console.log("ËßÜÈ¢ëÊí≠ÊîæÁªìÊùü");
        addLog("ËßÜÈ¢ëÊí≠ÊîæÁªìÊùü", "success");
      });

      let lastLoggedTime = -1;
      videoPlayer.addEventListener("timeupdate", function () {
        const currentTime = Math.floor(videoPlayer.currentTime);
        const duration = Math.floor(videoPlayer.duration);

        if (
          currentTime % 30 === 0 &&
          currentTime !== lastLoggedTime &&
          currentTime > 0
        ) {
          lastLoggedTime = currentTime;
          const progress = ((currentTime / duration) * 100).toFixed(1);
          addLog(
            `Êí≠ÊîæËøõÂ∫¶: ${currentTime}Áßí / ${duration}Áßí (${progress}%)`,
            "info"
          );
        }
      });

      videoPlayer.addEventListener("volumechange", function () {
        console.log("Èü≥ÈáèÂèòÂåñ:", videoPlayer.volume);
        const volume = (videoPlayer.volume * 100).toFixed(0);
        const muteStatus = videoPlayer.muted ? " (Â∑≤ÈùôÈü≥)" : "";
        addLog(`Èü≥ÈáèË∞ÉÊï¥‰∏∫: ${volume}%${muteStatus}`, "info");
      });

      videoPlayer.addEventListener("error", function (e) {
        console.error("ËßÜÈ¢ëÂä†ËΩΩÈîôËØØ:", e);

        // ËØ¶ÁªÜÁöÑÈîôËØØ‰ø°ÊÅØ
        let errorMsg = "ËßÜÈ¢ëÂä†ËΩΩÂ§±Ë¥•";
        let errorDetail = "";

        if (videoPlayer.error) {
          const errorCode = videoPlayer.error.code;
          const errorMessage = videoPlayer.error.message;

          switch (errorCode) {
            case 1:
              errorDetail = "MEDIA_ERR_ABORTED: Áî®Êà∑‰∏≠Ê≠¢‰∫ÜËßÜÈ¢ëÂä†ËΩΩ";
              break;
            case 2:
              errorDetail = "MEDIA_ERR_NETWORK: ÁΩëÁªúÈîôËØØ,ËßÜÈ¢ë‰∏ãËΩΩÂ§±Ë¥•";
              break;
            case 3:
              errorDetail = "MEDIA_ERR_DECODE: ËßÜÈ¢ëËß£Á†ÅÂ§±Ë¥•,ÂèØËÉΩÊ†ºÂºè‰∏çÊîØÊåÅ";
              break;
            case 4:
              errorDetail =
                "MEDIA_ERR_SRC_NOT_SUPPORTED: ËßÜÈ¢ëÊ†ºÂºèÊàñMIMEÁ±ªÂûã‰∏çÊîØÊåÅ";
              break;
            default:
              errorDetail = `Êú™Áü•ÈîôËØØ (‰ª£Á†Å: ${errorCode})`;
          }

          addLog(`${errorMsg}: ${errorDetail}`, "error");
          if (errorMessage) {
            addLog(`ÈîôËØØËØ¶ÊÉÖ: ${errorMessage}`, "error");
          }
        } else {
          addLog(errorMsg, "error");
        }

        addLog(`ËßÜÈ¢ëURL: ${videoPlayer.src}`, "error");
        addLog(`ÂΩìÂâçÁΩëÁªúÁä∂ÊÄÅ: ${videoPlayer.networkState}`, "error");
        addLog(`ÂΩìÂâçÂ∞±Áª™Áä∂ÊÄÅ: ${videoPlayer.readyState}`, "error");

        loading.classList.remove("show");
      });

      videoPlayer.addEventListener("waiting", function () {
        console.log("ËßÜÈ¢ëÁºìÂÜ≤‰∏≠...");
        addLog("ËßÜÈ¢ëÊ≠£Âú®ÁºìÂÜ≤...", "warning");
        loading.classList.add("show");
      });

      videoPlayer.addEventListener("playing", function () {
        console.log("ËßÜÈ¢ëÁªßÁª≠Êí≠Êîæ");
        addLog("ÁºìÂÜ≤ÂÆåÊàê,ÁªßÁª≠Êí≠Êîæ", "success");
        loading.classList.remove("show");
      });

      function showPlayIndicator() {
        playIndicator.classList.add("show");
        setTimeout(() => {
          playIndicator.classList.remove("show");
        }, 500);
      }

      let lastTouchEnd = 0;
      document.addEventListener(
        "touchend",
        function (event) {
          const now = Date.now();
          if (now - lastTouchEnd <= 300) {
            event.preventDefault();
          }
          lastTouchEnd = now;
        },
        false
      );

      videoPlayer.addEventListener("fullscreenchange", function () {
        console.log("ÂÖ®Â±èÁä∂ÊÄÅÊîπÂèò");
        const isFullscreen =
          document.fullscreenElement || document.webkitFullscreenElement;
        if (isFullscreen) {
          addLog("ËøõÂÖ•ÂÖ®Â±èÊ®°Âºè", "info");
        } else {
          addLog("ÈÄÄÂá∫ÂÖ®Â±èÊ®°Âºè", "info");
        }
      });

      videoPlayer.addEventListener("loadedmetadata", function () {
        const duration = Math.floor(videoPlayer.duration);
        const width = videoPlayer.videoWidth;
        const height = videoPlayer.videoHeight;
        addLog(
          `ËßÜÈ¢ëÂÖÉÊï∞ÊçÆÂä†ËΩΩÂÆåÊàê (Êó∂Èïø: ${duration}Áßí, ÂàÜËæ®Áéá: ${width}x${height})`,
          "info"
        );
      });

      videoPlayer.addEventListener("seeked", function () {
        const currentTime = Math.floor(videoPlayer.currentTime);
        addLog(`Áî®Êà∑Ë∑≥ËΩ¨Âà∞ ${currentTime}Áßí`, "info");
      });

      // iOSÁâπÊúâ‰∫ã‰ª∂ - suspend (ÊöÇÂÅú‰∏ãËΩΩ)
      videoPlayer.addEventListener("suspend", function () {
        addLog("ËßÜÈ¢ë‰∏ãËΩΩÊöÇÂÅú (suspend‰∫ã‰ª∂)", "warning");
        addLog(
          `ÊöÇÂÅúÊó∂ÁΩëÁªúÁä∂ÊÄÅ: ${videoPlayer.networkState}, Â∞±Áª™Áä∂ÊÄÅ: ${videoPlayer.readyState}`,
          "info"
        );
      });

      // Êï∞ÊçÆÂä†ËΩΩËøõÂ∫¶ - Ê∑ªÂä†ËäÇÊµÅ,ÊØè3ÁßíÊúÄÂ§öËÆ∞ÂΩï‰∏ÄÊ¨°
      videoPlayer.addEventListener("progress", function () {
        const now = Date.now();

        // ËäÇÊµÅ:Ë∑ùÁ¶ª‰∏äÊ¨°ËÆ∞ÂΩï‰∏çË∂≥3ÁßíÂàôË∑≥Ëøá
        if (now - lastProgressLog < 3000) {
          return;
        }

        if (videoPlayer.buffered.length > 0) {
          const bufferedEnd = videoPlayer.buffered.end(
            videoPlayer.buffered.length - 1
          );
          const duration = videoPlayer.duration;
          if (duration > 0) {
            const bufferedPercent = ((bufferedEnd / duration) * 100).toFixed(1);

            // Âè™ÊúâÁºìÂÜ≤ËøõÂ∫¶ÂèòÂåñÊòéÊòæ(>=5%)ÊâçËÆ∞ÂΩï
            const lastPercent = lastProgressLog
              ? ((lastProgressLog / duration) * 100).toFixed(1)
              : 0;
            if (
              Math.abs(bufferedPercent - lastPercent) >= 5 ||
              lastProgressLog === 0
            ) {
              addLog(
                `ÁºìÂÜ≤ËøõÂ∫¶: ${bufferedPercent}% (${bufferedEnd.toFixed(
                  1
                )}Áßí/${duration.toFixed(1)}Áßí)`,
                "info"
              );
              lastProgressLog = now;
            }
          }
        }
      });

      // ÂèØ‰ª•ÂºÄÂßãÊí≠Êîæ‰ΩÜËøòÊ≤°ÊúâË∂≥Â§üÊï∞ÊçÆ
      videoPlayer.addEventListener("canplaythrough", function () {
        addLog("ËßÜÈ¢ëÂ∑≤ÁºìÂÜ≤Ë∂≥Â§üÊï∞ÊçÆ,ÂèØ‰ª•ÊµÅÁïÖÊí≠Êîæ", "success");
      });

      // ÊµèËßàÂô®ÂÅúÊ≠¢Ëé∑ÂèñÂ™í‰ΩìÊï∞ÊçÆ
      videoPlayer.addEventListener("stalled", function () {
        addLog("ËßÜÈ¢ëÊï∞ÊçÆËé∑ÂèñÂÅúÊªû (stalled‰∫ã‰ª∂)", "warning");
        addLog(`ÂÅúÊªûÊó∂ÁΩëÁªúÁä∂ÊÄÅ: ${videoPlayer.networkState}`, "warning");
      });

      // loadeddata - Âä†ËΩΩ‰∫ÜÂΩìÂâçÂ∏ßÊï∞ÊçÆ
      videoPlayer.addEventListener("loadeddata", function () {
        addLog("ËßÜÈ¢ëÂΩìÂâçÂ∏ßÊï∞ÊçÆÂä†ËΩΩÂÆåÊàê", "success");
        addLog(`Âä†ËΩΩÂêéÂ∞±Áª™Áä∂ÊÄÅ: ${videoPlayer.readyState}`, "info");
      });

      // iOSÂèØËÉΩÈúÄË¶ÅÁî®Êà∑‰∫§‰∫íÊâçËÉΩÊí≠Êîæ
      videoPlayer.addEventListener("click", function () {
        if (videoPlayer.paused) {
          addLog("Áî®Êà∑ÁÇπÂáªËßÜÈ¢ëÂ∞ùËØïÊí≠Êîæ", "info");
          videoPlayer.play().catch(function (error) {
            addLog(`Êí≠ÊîæÂ§±Ë¥•: ${error.name} - ${error.message}`, "error");
          });
        }
      });

      // ÁõëÂê¨Êí≠ÊîæÊâøËØ∫ÁöÑÊãíÁªù
      const originalPlay = videoPlayer.play;
      videoPlayer.play = function () {
        const playPromise = originalPlay.apply(this, arguments);
        if (playPromise !== undefined) {
          playPromise
            .then(function () {
              addLog("Êí≠ÊîæÊàêÂäüÂêØÂä®", "success");
            })
            .catch(function (error) {
              addLog(`Êí≠ÊîæË¢´ÊãíÁªù: ${error.name} - ${error.message}`, "error");
              if (error.name === "NotAllowedError") {
                addLog("ÊèêÁ§∫: iOSÈúÄË¶ÅÁî®Êà∑‰∫§‰∫íÊâçËÉΩËá™Âä®Êí≠ÊîæËßÜÈ¢ë", "warning");
              } else if (error.name === "NotSupportedError") {
                addLog("ÊèêÁ§∫: ËßÜÈ¢ëÊ†ºÂºèÂèØËÉΩ‰∏çË¢´ÂΩìÂâçËÆæÂ§áÊîØÊåÅ", "warning");
              }
            });
        }
        return playPromise;
      };

      // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÊ∑ªÂä†ÂàùÂßãÊó•ÂøóÂíåËÆæÂ§á‰ø°ÊÅØ
      window.addEventListener("DOMContentLoaded", function () {
        addLog("È°µÈù¢Âä†ËΩΩÂÆåÊàê", "success");

        // Ê£ÄÊµãËÆæÂ§áÂíåÊµèËßàÂô®‰ø°ÊÅØ
        const userAgent = navigator.userAgent;
        const isIOS = /iPad|iPhone|iPod/.test(userAgent);
        const isSafari = /Safari/.test(userAgent) && !/Chrome/.test(userAgent);
        const isWeChat = /MicroMessenger/.test(userAgent);

        addLog(`ËÆæÂ§á‰ø°ÊÅØ: ${isIOS ? "iOSËÆæÂ§á" : "ÈùûiOSËÆæÂ§á"}`, "info");
        addLog(
          `ÊµèËßàÂô®: ${
            isSafari ? "Safari" : isWeChat ? "ÂæÆ‰ø°ÊµèËßàÂô®" : "ÂÖ∂‰ªñÊµèËßàÂô®"
          }`,
          "info"
        );
        addLog(`UserAgent: ${userAgent.substring(0, 100)}...`, "info");

        // Ê£ÄÊµãËßÜÈ¢ëÊîØÊåÅÊÉÖÂÜµ
        const canPlayMP4 = videoPlayer.canPlayType(
          'video/mp4; codecs="avc1.42E01E, mp4a.40.2"'
        );
        const canPlayWebM = videoPlayer.canPlayType(
          'video/webm; codecs="vp8, vorbis"'
        );
        const canPlayOgg = videoPlayer.canPlayType(
          'video/ogg; codecs="theora, vorbis"'
        );

        addLog(
          `MP4ÊîØÊåÅ: ${canPlayMP4 || "‰∏çÊîØÊåÅ"}`,
          canPlayMP4 ? "success" : "warning"
        );
        addLog(
          `WebMÊîØÊåÅ: ${canPlayWebM || "‰∏çÊîØÊåÅ"}`,
          canPlayWebM ? "info" : "warning"
        );
        addLog(
          `OggÊîØÊåÅ: ${canPlayOgg || "‰∏çÊîØÊåÅ"}`,
          canPlayOgg ? "info" : "warning"
        );

        // Ê£ÄÊµãÁΩëÁªúÁä∂ÊÄÅ
        if (
          navigator.connection ||
          navigator.mozConnection ||
          navigator.webkitConnection
        ) {
          const connection =
            navigator.connection ||
            navigator.mozConnection ||
            navigator.webkitConnection;
          addLog(
            `ÁΩëÁªúÁ±ªÂûã: ${
              connection.effectiveType || connection.type || "Êú™Áü•"
            }`,
            "info"
          );
        }

        // ËæìÂá∫ÂΩìÂâçËßÜÈ¢ëÊ∫ê
        addLog(`ÂΩìÂâçËßÜÈ¢ëÊ∫ê: ${videoPlayer.src}`, "info");
        addLog(
          `ËßÜÈ¢ëÂ∞±Áª™Áä∂ÊÄÅ: ${videoPlayer.readyState} (0=Êú™Âä†ËΩΩ, 1=ÂÖÉÊï∞ÊçÆ, 2=ÂΩìÂâçÂ∏ß, 3=Êú™Êù•Êï∞ÊçÆ, 4=Ë∂≥Â§üÊï∞ÊçÆ)`,
          "info"
        );
        addLog(
          `ËßÜÈ¢ëÁΩëÁªúÁä∂ÊÄÅ: ${videoPlayer.networkState} (0=Á©∫Èó≤, 1=Âä†ËΩΩ‰∏≠, 2=Êó†Ê∫ê, 3=ÁΩëÁªúÈîôËØØ)`,
          "info"
        );

        // Â∞ùËØï‰∏ªÂä®Âä†ËΩΩËßÜÈ¢ë
        if (videoPlayer.readyState === 0 && videoPlayer.src) {
          addLog("Ê£ÄÊµãÂà∞ËßÜÈ¢ëÊú™ÂºÄÂßãÂä†ËΩΩ,Â∞ùËØïÊâãÂä®Ëß¶Âèëload()", "warning");
          videoPlayer.load();

          // 5ÁßíÂêéÂÜçÊ¨°Ê£ÄÊü•
          setTimeout(function () {
            addLog(
              `5ÁßíÂêéÂÜçÊ¨°Ê£ÄÊü• - Â∞±Áª™Áä∂ÊÄÅ: ${videoPlayer.readyState}, ÁΩëÁªúÁä∂ÊÄÅ: ${videoPlayer.networkState}`,
              "info"
            );

            if (videoPlayer.readyState === 0) {
              addLog("ËßÜÈ¢ë‰ªçÊú™Âä†ËΩΩ,ÂèØËÉΩÂ≠òÂú®‰ª•‰∏ãÈóÆÈ¢ò:", "error");
              addLog("1. iOSÈúÄË¶ÅÁî®Êà∑‰∫§‰∫íÊâçËÉΩÂä†ËΩΩËßÜÈ¢ë(Â∞ùËØïÁÇπÂáªËßÜÈ¢ë)", "warning");
              addLog("2. ËßÜÈ¢ëURLÂèØËÉΩÊó†Ê≥ïËÆøÈóÆÊàñCORSÈôêÂà∂", "warning");
              addLog("3. ÁΩëÁªúËøûÊé•ÈóÆÈ¢ò", "warning");
              addLog("4. ËßÜÈ¢ëÊ†ºÂºè‰∏çË¢´ÂΩìÂâçËÆæÂ§áÊîØÊåÅ", "warning");

              // Âú®iOS‰∏ä,Â∞ùËØïÈÄöËøá‰ª£Á†ÅËß¶Âèë‰∏ÄÊ¨°Êí≠ÊîæÊù•ÊøÄÊ¥ªËßÜÈ¢ë
              if (isIOS) {
                addLog("Ê£ÄÊµãÂà∞iOSËÆæÂ§á,Âª∫ËÆÆÁÇπÂáªËßÜÈ¢ëËøõË°åÊí≠Êîæ", "warning");
              }
            }
          }, 5000);
        }
      });

      // È°µÈù¢Âç∏ËΩΩÊó∂Ê∏ÖÁêÜËµÑÊ∫ê
      window.addEventListener("beforeunload", function () {
        if (currentVideoFile) {
          URL.revokeObjectURL(currentVideoFile);
        }
      });
    </script>
    <script src="../../shared/scripts/common.js"></script>
    <script src="../../shared/scripts/theme.js"></script>
  </body>
</html>
