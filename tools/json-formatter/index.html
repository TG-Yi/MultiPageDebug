<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>JSON æ ¼å¼åŒ–å·¥å…· - å¼€å‘å·¥å…·ç®±</title>
    <link rel="stylesheet" href="../../shared/styles/common.css" />
    <!-- Font Awesome å›¾æ ‡åº“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: linear-gradient(
          135deg,
          #1e3a5f 0%,
          #3d5a80 20%,
          #ee6c4d 50%,
          #f4a261 75%,
          #e9c46a 100%
        );
        min-height: 100vh;
        padding: 20px;
      }

      .main-container {
        max-width: 1600px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .title {
        color: white;
        font-size: 28px;
        font-weight: 700;
        text-align: center;
        margin: 20px 0;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      /* å·¥å…·æ  */
      .toolbar {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: center;
      }

      .toolbar-group {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }


      /* å·¥å…·æ åˆ†ç»„æ ‡ç­¾ */
      .toolbar-group-label {
        font-size: 12px;
        font-weight: 600;
        color: var(--text-light);
        margin-right: 4px;
        white-space: nowrap;
        align-self: center;
      }

      .toolbar-divider {
        width: 1px;
        height: 36px;
        background: var(--border-color);
        margin: 0 8px;
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        white-space: nowrap;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
      }

      .btn i {
        font-size: 1.1em;
      }

      .btn-primary {
        background: linear-gradient(135deg, #ee6c4d, #f4a261);
        color: white;
        box-shadow: 0 4px 12px rgba(238, 108, 77, 0.3);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(238, 108, 77, 0.4);
      }

      .btn-secondary {
        background: white;
        color: var(--text-color);
        border: 2px solid var(--border-color);
      }

      .btn-secondary:hover {
        border-color: var(--primary-color);
        color: var(--primary-color);
      }

      .btn-success {
        background: var(--success-color);
        color: white;
      }

      .btn-warning {
        background: var(--warning-color);
        color: white;
      }

      .btn:active {
        transform: scale(0.95);
      }


      /* Tabåˆ‡æ¢æŒ‰é’®æ ·å¼ */
      .tab-switch-btn.active {
        background: linear-gradient(135deg, #ee6c4d, #f4a261);
        color: white;
        border-color: transparent;
      }

      .tab-switch-btn.active:hover {
        transform: translateY(-2px);
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .indent-label {
        font-weight: 600;
        color: var(--text-color);
        white-space: nowrap;
      }

      .indent-select {
        padding: 8px 12px;
        border: 2px solid var(--border-color);
        border-radius: 8px;
        font-size: 14px;
        background: white;
        cursor: pointer;
      }

      /* ä¸»å·¥ä½œåŒº */
      .workspace {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        height: 70vh;  /* å›ºå®šé«˜åº¦ä¸ºè§†å£é«˜åº¦çš„70% */
        min-height: 500px;  /* æœ€å°é«˜åº¦ä¿è¯å°å±å¹•å¯ç”¨ */
        max-height: 900px;  /* æœ€å¤§é«˜åº¦é¿å…å¤§å±å¹•è¿‡é«˜ */
      }

      .panel {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        height: 100%;  /* å¡«æ»¡ workspace çš„é«˜åº¦ */
        overflow: hidden;  /* é˜²æ­¢å†…å®¹æº¢å‡º */
      }

      .panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--border-color);
      }

      .panel-title {
        font-size: 18px;
        font-weight: 700;
        color: var(--text-color);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .panel-actions {
        display: flex;
        gap: 8px;
      }

      .icon-btn {
        width: 36px;
        height: 36px;
        border: none;
        background: var(--bg-color);
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        transition: all 0.3s ease;
      }

      .icon-btn:hover {
        background: var(--primary-color);
        color: white;
        transform: scale(1.1);
      }

      .icon-btn:active {
        transform: scale(0.95);
      }

      .editor-wrapper {
        flex: 1;
        position: relative;
        overflow: hidden;
        border-radius: 10px;
        background: #282c34;
        border: 2px solid #21252b;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      }

      .editor {
        width: 100%;
        height: 100%;
        padding: 15px;
        border: none;
        background: #282c34;
        color: #abb2bf;
        font-family: "Monaco", "Menlo", "Courier New", monospace;
        font-size: 14px;
        line-height: 1.6;
        resize: none;
        outline: none;
      }

      .editor::placeholder {
        color: #5c6370;
      }

      /* çŠ¶æ€æ  */
      .status-bar {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 15px 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
      }

      .status-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: var(--text-color);
      }

      .status-label {
        font-weight: 600;
      }

      .status-value {
        color: var(--text-light);
      }

      .status-badge {
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
      }

      .status-badge.valid {
        background: rgba(42, 157, 143, 0.1);
        color: var(--success-color);
      }

      .status-badge.error {
        background: rgba(231, 111, 81, 0.1);
        color: var(--error-color);
      }

      /* é”™è¯¯æç¤º */
      .error-box {
        background: rgba(231, 111, 81, 0.1);
        border-left: 4px solid var(--error-color);
        border-radius: 8px;
        padding: 12px 15px;
        margin-top: 10px;
        color: var(--error-color);
        font-size: 13px;
        line-height: 1.6;
        display: none;
      }

      .error-box.show {
        display: block;
        animation: slideDown 0.3s ease;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .error-box strong {
        display: block;
        margin-bottom: 4px;
      }


      /* æ ‘å½¢è§†å›¾åŒ…è£¹å®¹å™¨ */
      .tree-view-wrapper {
        flex: 1;
        position: relative;
        overflow: hidden;
        border-radius: 10px;
        background: #ffffff;
        border: 2px solid #e1e4e8;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        display: flex;
        flex-direction: column;
      }
      /* æ ‘å½¢è§†å›¾ */
      .tree-view {
        font-family: "Monaco", "Menlo", "Courier New", monospace;
        font-size: 13px;
        line-height: 1.8;
        color: #2c3e50;
        overflow-y: auto;
        overflow-x: auto;
        flex: 1;
        padding: 15px;
        background: #ffffff;
        /* ç§»åŠ¨ç«¯è§¦æ‘¸æ»šåŠ¨ä¼˜åŒ– */
        -webkit-overflow-scrolling: touch;
        /* WebKitæ»šåŠ¨æ¡æ ·å¼ */
        scrollbar-width: thin;
        scrollbar-color: #cbd5e0 #f7fafc;
      }

      .tree-view::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      .tree-view::-webkit-scrollbar-track {
        background: #f7fafc;
        border-radius: 4px;
      }

      .tree-view::-webkit-scrollbar-thumb {
        background: #cbd5e0;
        border-radius: 4px;
      }

      .tree-view::-webkit-scrollbar-thumb:hover {
        background: #a0aec0;
      }

      .tree-node {
        margin-left: 20px;
      }

      .tree-key {
        color: #0066cc;
        font-weight: 600;
      }

      .tree-string {
        color: #22863a;
      }

      .tree-number {
        color: #005cc5;
      }

      .tree-boolean {
        color: #d73a49;
        font-weight: 600;
      }

      .tree-null {
        color: #6f42c1;
        font-weight: 600;
      }

      .tree-toggle {
        cursor: pointer;
        user-select: none;
        color: #666;
        margin-right: 4px;
      }

      .tree-toggle:hover {
        color: var(--primary-color);
      }

      .tree-collapsed {
        display: none;
      }

      /* é€‰é¡¹å¡ */
      .tabs {
        display: flex;
        gap: 4px;
        margin-bottom: 0;
        border-bottom: 2px solid var(--border-color);
        padding: 15px 15px 0 15px;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 16px 16px 0 0;
      }



      /* Tabåˆ†éš”ç¬¦ */
      .tab-divider {
        width: 2px;
        height: 24px;
        background: var(--border-color);
        margin: 0 8px;
        align-self: center;
      }

      /* åŠ¨æ€æ ‡é¢˜æ  */
      .panel-dynamic-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: white;
        border-bottom: 2px solid var(--border-color);
      }

      .panel-dynamic-title {
        font-size: 18px;
        font-weight: 700;
        color: var(--text-color);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .panel-dynamic-actions {
        display: flex;
        gap: 8px;
      }

      .tab {
        padding: 10px 18px;
        background: transparent;
        border: none;
        border-bottom: 3px solid transparent;
        color: var(--text-light);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        margin-bottom: -2px;
      }

      .tab:hover {
        color: var(--primary-color);
        background: rgba(238, 108, 77, 0.05);
      }

      .tab.active {
        color: var(--primary-color);
        border-bottom-color: var(--primary-color);
        background: white;
      }

      .tab-content {
        display: none;
        flex: 1;
        overflow: hidden;
        min-height: 0;
      }

      .tab-content.active {
        display: flex;
        flex-direction: column;
      }

      /* å“åº”å¼ */
      @media (max-width: 1200px) {
        .workspace {
          grid-template-columns: 1fr;
          height: auto;  /* ç§»åŠ¨ç«¯ä½¿ç”¨è‡ªåŠ¨é«˜åº¦ */
          min-height: 500px;
        }

        .toolbar {
          justify-content: center;
        }

        .toolbar-divider {
          display: none;
        }

        .editor-wrapper {
          min-height: 300px;
        }
      }

      @media (max-width: 768px) {
        body {
          padding: 10px;
        }

        .title {
          font-size: 20px;
          margin: 10px 0 15px;
        }

        .main-container {
          gap: 15px;
        }

        .toolbar {
          padding: 12px;
          gap: 8px;
        }

        .toolbar-group {
          width: 100%;
          justify-content: center;
        }

        .btn {
          padding: 8px 12px;
          font-size: 16px;
          flex: 1;
          min-width: 0;
          justify-content: center;
          gap: 0;
        }

        .btn .btn-text {
          display: none;
        }

        .indent-label {
          display: none;
        }

        .indent-select {
          padding: 6px 10px;
          font-size: 12px;
          flex: 1;
        }

        .panel {
          padding: 12px;
        }

        .panel-header {
          margin-bottom: 10px;
          padding-bottom: 10px;
        }

        .panel-title {
          font-size: 16px;
        }

        .icon-btn {
          width: 32px;
          height: 32px;
          font-size: 14px;
        }

        .editor-wrapper {
          min-height: 250px;
        }

        .editor {
          padding: 10px;
          font-size: 12px;
        }

        .tabs {
          gap: 4px;
          overflow-x: auto;
          flex-wrap: nowrap;
          -webkit-overflow-scrolling: touch;
        }

        .tab {
          padding: 6px 12px;
          font-size: 12px;
          white-space: nowrap;
          flex-shrink: 0;
        }

        .tab i {
          margin-right: 4px;
        }

        .status-bar {
          padding: 10px 12px;
          gap: 10px;
        }

        .status-item {
          font-size: 11px;
        }

        .status-badge {
          padding: 3px 10px;
          font-size: 11px;
        }

        .error-box {
          padding: 10px 12px;
          font-size: 12px;
        }

        .stats-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 10px;
        }

        .stat-card {
          padding: 12px;
        }

        .stat-value {
          font-size: 20px;
        }

        .stat-label {
          font-size: 11px;
        }

        .convert-panel {
          gap: 10px;
        }

        .convert-option {
          flex-direction: column;
          align-items: stretch;
        }

        .convert-option label {
          font-size: 13px;
          margin-bottom: 6px;
        }

      /* è½¬æ¢é¢æ¿æ ·å¼ */
      .convert-options-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 10px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
        margin-bottom: 15px;
      }

      .convert-option-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        padding: 15px 10px;
        background: white;
        border: 2px solid var(--border-color);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 13px;
        font-weight: 600;
        color: var(--text-color);
      }

      .convert-option-btn i {
        font-size: 24px;
        color: var(--primary-color);
      }

      .convert-option-btn:hover {
        border-color: var(--primary-color);
        background: rgba(238, 108, 77, 0.05);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(238, 108, 77, 0.2);
      }

      .convert-option-btn:active {
        transform: translateY(0);
      }

      .convert-result-section {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 0;
      }

      .convert-result-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        background: #f8f9fa;
        border-radius: 8px;
        margin-bottom: 10px;
      }

      .convert-result-label {
        font-weight: 600;
        color: var(--success-color);
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .convert-result-hint {
        font-size: 12px;
        color: var(--text-light);
        font-style: italic;
      }


        .convert-option .btn {
          width: 100%;
        }

        .tree-view {
          font-size: 11px;
          padding: 8px;
          line-height: 1.6;
        }

        .tree-view-wrapper {
          border-width: 1px;
        }
      }

      @media (max-width: 480px) {
        .title {
          font-size: 18px;
        }

        .main-container {
          gap: 12px;
        }

        .workspace {
          gap: 12px;
        }

        .toolbar {
          padding: 10px;
        }

        .btn {
          padding: 10px;
          font-size: 18px;
          min-width: 40px;
        }

        .editor-wrapper {
          min-height: 180px;
        }

        .stats-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 8px;
        }

        .stat-card {
          padding: 10px;
        }

        .stat-value {
          font-size: 18px;
        }

        .stat-label {
          font-size: 10px;
        }

        .panel {
          padding: 10px;
        }

        .panel-header {
          margin-bottom: 8px;
          padding-bottom: 8px;
        }

        .panel-title {
          font-size: 14px;
        }

        .panel-actions {
          gap: 6px;
        }

        .icon-btn {
          width: 30px;
          height: 30px;
          font-size: 13px;
        }

        .tabs {
          margin-bottom: 10px;
          padding-bottom: 8px;
        }

        .tab {
          padding: 6px 10px;
          font-size: 11px;
        }

        .status-bar {
          padding: 8px 10px;
          gap: 8px;
        }

        .status-item {
          font-size: 10px;
        }

        .status-badge {
          padding: 2px 8px;
          font-size: 10px;
        }

        .convert-output-wrapper {
          min-height: 150px;
        }
      }

      /* ä¸»é¢˜åˆ‡æ¢æŒ‰é’® */
      .theme-toggle-btn {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 56px;
        height: 56px;
        background: rgba(255, 255, 255, 0.95);
        border: none;
        border-radius: 50%;
        font-size: 26px;
        cursor: pointer;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
        z-index: 9998;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .theme-toggle-btn:hover {
        transform: scale(1.1) rotate(15deg);
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
      }

      .theme-toggle-btn:active {
        transform: scale(0.95);
      }

      @media (max-width: 768px) {
        .theme-toggle-btn {
          width: 48px;
          height: 48px;
          font-size: 22px;
          bottom: 20px;
          right: 20px;
        }
      }

      /* è½¬æ¢é¢æ¿ */
      .convert-panel {
        display: flex;
        flex-direction: column;
        height: 100%;
        gap: 0;
      }

      .convert-option {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .convert-option label {
        flex: 1;
        font-weight: 600;
        color: var(--text-color);
      }


      

      /* ç»Ÿè®¡å¡ç‰‡ */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 12px;
      }

      .stat-card {
        background: var(--bg-color);
        padding: 15px;
        border-radius: 10px;
        text-align: center;
      }

      .stat-value {
        font-size: 24px;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 4px;
      }

      .stat-label {
        font-size: 12px;
        color: var(--text-light);
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <!-- ä¸»é¢˜è®¾ç½®æŒ‰é’® -->
    <button
      class="theme-toggle-btn"
      onclick="openThemeSelector()"
      title="ä¸»é¢˜è®¾ç½®"
    >
      ğŸ¨
    </button>

    <a href="../../index.html" class="back-home-btn">è¿”å›é¦–é¡µ</a>

    <div class="main-container">
      <h1 class="title">ğŸ”§ JSON æ ¼å¼åŒ–å·¥å…·</h1>

      <!-- å·¥å…·æ  - ä»…JSONå¤„ç†å’Œè§†å›¾åŠŸèƒ½ -->
      <div class="toolbar">
        <!-- JSONå¤„ç† -->
        <div class="toolbar-group">
          <button class="btn btn-primary" id="formatBtn" title="æ ¼å¼åŒ– JSON">
            <i class="fa-solid fa-wand-magic-sparkles"></i><span class="btn-text">æ ¼å¼åŒ–</span>
          </button>
          <button class="btn btn-secondary" id="compressBtn" title="å‹ç¼© JSON">
            <i class="fa-solid fa-compress"></i><span class="btn-text">å‹ç¼©</span>
          </button>
          <button class="btn btn-secondary" id="validateBtn" title="éªŒè¯ JSON">
            <i class="fa-solid fa-circle-check"></i><span class="btn-text">éªŒè¯</span>
          </button>
          <button class="btn btn-secondary" id="sortBtn" title="æ’åºé”®">
            <i class="fa-solid fa-arrow-down-a-z"></i><span class="btn-text">æ’åº</span>
          </button>
          <label class="indent-label"><i class="fa-solid fa-indent"></i> ç¼©è¿›:</label>
          <select class="indent-select" id="indentSize">
            <option value="2" selected>2ç©ºæ ¼</option>
            <option value="4">4ç©ºæ ¼</option>
            <option value="tab">Tab</option>
          </select>
        </div>

        <div class="toolbar-divider"></div>

        <!-- æŸ¥çœ‹æ¨¡å¼ -->
        <div class="toolbar-group">
          <button class="btn btn-secondary tab-switch-btn active" data-tab="formatted" title="æ ¼å¼åŒ–è§†å›¾">
            <i class="fa-solid fa-align-left"></i><span class="btn-text">æ ¼å¼åŒ–</span>
          </button>
          <button class="btn btn-secondary tab-switch-btn" data-tab="tree" title="æ ‘å½¢è§†å›¾">
            <i class="fa-solid fa-sitemap"></i><span class="btn-text">æ ‘å½¢</span>
          </button>
          <button class="btn btn-secondary tab-switch-btn" data-tab="stats" title="æ•°æ®ç»Ÿè®¡">
            <i class="fa-solid fa-chart-simple"></i><span class="btn-text">ç»Ÿè®¡</span>
          </button>
        </div>

        <div class="toolbar-divider"></div>

        <!-- æ•°æ®æ ¼å¼è½¬æ¢ -->
        <div class="toolbar-group">
          <span class="toolbar-group-label">è½¬ä¸º:</span>
          <button class="btn btn-secondary tab-switch-btn" data-tab="convert-xml" title="è½¬æ¢ä¸ºXML">
            <i class="fa-solid fa-code"></i><span class="btn-text">XML</span>
          </button>
          <button class="btn btn-secondary tab-switch-btn" data-tab="convert-yaml" title="è½¬æ¢ä¸ºYAML">
            <i class="fa-solid fa-file-lines"></i><span class="btn-text">YAML</span>
          </button>
          <button class="btn btn-secondary tab-switch-btn" data-tab="convert-csv" title="è½¬æ¢ä¸ºCSV">
            <i class="fa-solid fa-table"></i><span class="btn-text">CSV</span>
          </button>
          <button class="btn btn-secondary tab-switch-btn" data-tab="convert-url" title="è½¬æ¢ä¸ºURLå‚æ•°">
            <i class="fa-solid fa-link"></i><span class="btn-text">URL</span>
          </button>
        </div>

        <div class="toolbar-divider"></div>

        <!-- JSç›¸å…³è½¬æ¢ -->
        <div class="toolbar-group">
          <span class="toolbar-group-label">JS:</span>
          <button class="btn btn-secondary tab-switch-btn" data-tab="convert-jsobj" title="JSONè½¬JSå¯¹è±¡">
            <i class="fa-brands fa-js"></i><span class="btn-text">â†’å¯¹è±¡</span>
          </button>
          <button class="btn btn-secondary tab-switch-btn" data-tab="convert-json2js" title="JSå¯¹è±¡è½¬JSON">
            <i class="fa-solid fa-bracket-curly"></i><span class="btn-text">å¯¹è±¡â†’</span>
          </button>
          <button class="btn btn-secondary tab-switch-btn" data-tab="convert-stringify" title="JSONå­—ç¬¦ä¸²åŒ–">
            <i class="fa-solid fa-quote-left"></i><span class="btn-text">â†’å­—ç¬¦ä¸²</span>
          </button>
          <button class="btn btn-secondary tab-switch-btn" data-tab="convert-parse" title="è§£æJSONå­—ç¬¦ä¸²">
            <i class="fa-solid fa-quote-right"></i><span class="btn-text">å­—ç¬¦ä¸²â†’</span>
          </button>
        </div>
      </div>

      <!-- ä¸»å·¥ä½œåŒº -->
      <div class="workspace">
        <!-- è¾“å…¥é¢æ¿ -->
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">
              <i class="fa-solid fa-pen-to-square"></i>
              <span>è¾“å…¥ JSON</span>
            </div>
            <div class="panel-actions">
              <input type="file" id="fileInput" accept=".json" style="display: none;" />
              <button class="icon-btn" id="loadFileBtn" title="åŠ è½½æ–‡ä»¶"><i class="fa-solid fa-folder-open"></i></button>
              <button class="icon-btn" id="pasteBtn" title="ç²˜è´´"><i class="fa-solid fa-paste"></i></button>
              <button class="icon-btn" id="clearInputBtn" title="æ¸…ç©º"><i class="fa-solid fa-eraser"></i></button>
            </div>
          </div>
          <div class="editor-wrapper">
            <textarea
              class="editor"
              id="inputEditor"
              placeholder='åœ¨æ­¤è¾“å…¥æˆ–ç²˜è´´ JSON æ•°æ®ã€JavaScript å¯¹è±¡æˆ– JSON å­—ç¬¦ä¸²...

JSON å¯¹è±¡ç¤ºä¾‹:
{
  "name": "å¼ ä¸‰",
  "age": 28,
  "skills": ["JavaScript", "React", "Node.js"]
}

JS å¯¹è±¡ç¤ºä¾‹(ç”¨äº"JS å¯¹è±¡è½¬ JSON"):
{
  name: "å¼ ä¸‰",
  age: 28,
  skills: ["JavaScript", "React", "Node.js"]
}

JSON å­—ç¬¦ä¸²ç¤ºä¾‹(ç”¨äº"JSON å­—ç¬¦ä¸²è½¬å¯¹è±¡"):
"{\"name\":\"å¼ ä¸‰\",\"age\":28}"'
              spellcheck="false"
            ></textarea>
          </div>
          <div class="error-box" id="errorBox"></div>
        </div>

        <!-- è¾“å‡ºé¢æ¿ -->
        <div class="panel">
          <!-- åŠ¨æ€æ ‡é¢˜æ (è”åŠ¨æ˜¾ç¤ºå½“å‰Tabå†…å®¹) -->
          <div class="panel-dynamic-header">
            <div class="panel-dynamic-title">
              <i class="fa-solid fa-file-code" id="dynamicIcon"></i>
              <span id="dynamicTitle">æ ¼å¼åŒ–è¾“å‡º</span>
            </div>
            <div class="panel-dynamic-actions">
              <button class="icon-btn" id="downloadBtn" title="ä¸‹è½½">
                <i class="fa-solid fa-download"></i>
              </button>
              <button class="icon-btn" id="copyOutputBtn" title="å¤åˆ¶">
                <i class="fa-solid fa-copy"></i>
              </button>
              <button class="icon-btn" id="clearOutputBtn" title="æ¸…ç©º">
                <i class="fa-solid fa-xmark"></i>
              </button>
            </div>
          </div>

          <!-- æ ¼å¼åŒ–è¾“å‡º -->
          <div class="tab-content active" data-content="formatted">
            <div class="editor-wrapper">
              <textarea
                class="editor"
                id="outputEditor"
                placeholder="æ ¼å¼åŒ–åçš„ JSON å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."
                spellcheck="false"
                readonly
              ></textarea>
            </div>
          </div>

          <!-- æ ‘å½¢è§†å›¾ -->
          <div class="tab-content" data-content="tree">
            <div class="tree-view-wrapper">
              <div class="tree-view" id="treeView">
                <div style="color: #999; text-align: center; padding: 40px;">
                  æš‚æ— æ•°æ®
                </div>
              </div>
            </div>
          </div>

          <!-- XMLè½¬æ¢ -->
          <div class="tab-content" data-content="convert-xml">
            <div class="editor-wrapper">
              <textarea
                class="editor"
                id="convertOutput"
                placeholder="XMLæ ¼å¼ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."
                spellcheck="false"
                readonly
              ></textarea>
            </div>
          </div>

          <!-- YAMLè½¬æ¢ -->
          <div class="tab-content" data-content="convert-yaml">
            <div class="editor-wrapper">
              <textarea
                class="editor"
                id="yamlOutput"
                placeholder="YAMLæ ¼å¼ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."
                spellcheck="false"
                readonly
              ></textarea>
            </div>
          </div>

          <!-- CSVè½¬æ¢ -->
          <div class="tab-content" data-content="convert-csv">
            <div class="editor-wrapper">
              <textarea
                class="editor"
                id="csvOutput"
                placeholder="CSVæ ¼å¼ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."
                spellcheck="false"
                readonly
              ></textarea>
            </div>
          </div>

          <!-- URLå‚æ•°è½¬æ¢ -->
          <div class="tab-content" data-content="convert-url">
            <div class="editor-wrapper">
              <textarea
                class="editor"
                id="urlOutput"
                placeholder="URLå‚æ•°æ ¼å¼ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."
                spellcheck="false"
                readonly
              ></textarea>
            </div>
          </div>

          <!-- JSå¯¹è±¡è½¬æ¢ -->
          <div class="tab-content" data-content="convert-jsobj">
            <div class="editor-wrapper">
              <textarea
                class="editor"
                id="jsobjOutput"
                placeholder="JavaScriptå¯¹è±¡æ ¼å¼ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."
                spellcheck="false"
                readonly
              ></textarea>
            </div>
          </div>

          <!-- JSâ†’JSONè½¬æ¢ -->
          <div class="tab-content" data-content="convert-json2js">
            <div class="editor-wrapper">
              <textarea
                class="editor"
                id="json2jsOutput"
                placeholder="JSONæ ¼å¼ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ(ä»JSå¯¹è±¡è½¬æ¢)..."
                spellcheck="false"
                readonly
              ></textarea>
            </div>
          </div>

          <!-- å­—ç¬¦ä¸²åŒ–è½¬æ¢ -->
          <div class="tab-content" data-content="convert-stringify">
            <div class="editor-wrapper">
              <textarea
                class="editor"
                id="stringifyOutput"
                placeholder="JSONå­—ç¬¦ä¸²æ ¼å¼ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."
                spellcheck="false"
                readonly
              ></textarea>
            </div>
          </div>

          <!-- è§£æå­—ç¬¦ä¸²è½¬æ¢ -->
          <div class="tab-content" data-content="convert-parse">
            <div class="editor-wrapper">
              <textarea
                class="editor"
                id="parseOutput"
                placeholder="è§£æåçš„JSONå¯¹è±¡å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."
                spellcheck="false"
                readonly
              ></textarea>
            </div>
          </div>

          <!-- æ•°æ®ç»Ÿè®¡ -->
          <div class="tab-content" data-content="stats">
            <div class="stats-grid" id="statsGrid">
              <div class="stat-card">
                <div class="stat-value" id="statKeys">0</div>
                <div class="stat-label">é”®æ€»æ•°</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="statObjects">0</div>
                <div class="stat-label">å¯¹è±¡æ•°</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="statArrays">0</div>
                <div class="stat-label">æ•°ç»„æ•°</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="statStrings">0</div>
                <div class="stat-label">å­—ç¬¦ä¸²</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="statNumbers">0</div>
                <div class="stat-label">æ•°å­—</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="statBooleans">0</div>
                <div class="stat-label">å¸ƒå°”å€¼</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="statNulls">0</div>
                <div class="stat-label">Null</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="statDepth">0</div>
                <div class="stat-label">æœ€å¤§æ·±åº¦</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- çŠ¶æ€æ  -->
      <div class="status-bar">
        <div class="status-item">
          <span class="status-label">çŠ¶æ€:</span>
          <span class="status-badge valid" id="statusBadge">å°±ç»ª</span>
        </div>
        <div class="status-item">
          <span class="status-label">å­—ç¬¦æ•°:</span>
          <span class="status-value" id="charCount">0</span>
        </div>
        <div class="status-item">
          <span class="status-label">è¡Œæ•°:</span>
          <span class="status-value" id="lineCount">0</span>
        </div>
        <div class="status-item">
          <span class="status-label">å¤§å°:</span>
          <span class="status-value" id="sizeInfo">0 B</span>
        </div>
      </div>
    </div>

    <script src="../../shared/scripts/common.js"></script>
    <script src="../../shared/scripts/theme.js"></script>
    <script>
      // å…¨å±€å˜é‡
      let currentJson = null;
      let currentIndent = 2;

      // DOM å…ƒç´ 
      const inputEditor = document.getElementById("inputEditor");
      const outputEditor = document.getElementById("outputEditor");
      const errorBox = document.getElementById("errorBox");
      const statusBadge = document.getElementById("statusBadge");
      const charCount = document.getElementById("charCount");
      const lineCount = document.getElementById("lineCount");
      const sizeInfo = document.getElementById("sizeInfo");
      const indentSelect = document.getElementById("indentSize");
      const treeView = document.getElementById("treeView");
      const convertOutput = document.getElementById("convertOutput");

      // åˆå§‹åŒ–
      function init() {
        // ç»‘å®šäº‹ä»¶
        document.getElementById("formatBtn").addEventListener("click", formatJson);
        document.getElementById("compressBtn").addEventListener("click", compressJson);
        document.getElementById("validateBtn").addEventListener("click", validateJson);
        document.getElementById("sortBtn").addEventListener("click", sortKeys);

        // æ–‡ä»¶æ“ä½œå’Œç¼–è¾‘æŒ‰é’®ï¼ˆç°åœ¨åœ¨é¢æ¿ä¸­ï¼‰
        document.getElementById("downloadBtn").addEventListener("click", downloadJson);
        document.getElementById("pasteBtn").addEventListener("click", pasteFromClipboard);
        document.getElementById("clearInputBtn").addEventListener("click", clearInput);
        document.getElementById("copyOutputBtn").addEventListener("click", copyOutput);
        document.getElementById("clearOutputBtn").addEventListener("click", clearOutput);
        document.getElementById("loadFileBtn").addEventListener("click", () => {
          document.getElementById("fileInput").click();
        });
        document.getElementById("fileInput").addEventListener("change", loadFile);

        // ç¼©è¿›é€‰æ‹©
        indentSelect.addEventListener("change", (e) => {
          currentIndent = e.target.value === "tab" ? "\t" : parseInt(e.target.value);
          if (currentJson) {
            formatJson();
          }
        });

        // è¾“å…¥å®æ—¶æ›´æ–°
        inputEditor.addEventListener("input", debounce(() => {
          updateStats();
          autoValidate();
        }, 300));

        // é€‰é¡¹å¡åˆ‡æ¢ - ç»‘å®šå·¥å…·æ çš„TabæŒ‰é’®
        document.querySelectorAll(".tab-switch-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            const targetTab = btn.dataset.tab;

            // æ›´æ–°æŒ‰é’®æ¿€æ´»çŠ¶æ€
            document.querySelectorAll(".tab-switch-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");

            // åˆ‡æ¢å†…å®¹
            switchTab(targetTab);
          });
        });

        // Tabåˆ‡æ¢æ—¶è‡ªåŠ¨æ‰§è¡Œè½¬æ¢(ä¸éœ€è¦å•ç‹¬çš„æŒ‰é’®äº‹ä»¶)
      }

      // å¤„ç†è½¬æ¢Tabåˆ‡æ¢
      function handleConvertTab(tabName) {
        const type = tabName.replace("convert-", "");

        switch(type) {
          case "xml":
            convertToXml("convertOutput");
            break;
          case "yaml":
            convertToYaml("yamlOutput");
            break;
          case "csv":
            convertToCsv("csvOutput");
            break;
          case "url":
            convertToUrlParams("urlOutput");
            break;
          case "jsobj":
            convertToJsObject("jsobjOutput");
            break;
          case "json2js":
            convertJsObjectToJson("json2jsOutput");
            break;
          case "stringify":
            convertToJsonString("stringifyOutput");
            break;
          case "parse":
            convertJsonStringToObject("parseOutput");
            break;
        }
      }

      // é˜²æŠ–å‡½æ•°
      function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }

      // æ ¼å¼åŒ– JSON
      function formatJson() {
        try {
          const input = inputEditor.value.trim();
          if (!input) {
            showError("è¯·è¾“å…¥ JSON æ•°æ®");
            return;
          }

          currentJson = JSON.parse(input);
          const formatted = JSON.stringify(currentJson, null, currentIndent);
          outputEditor.value = formatted;

          hideError();
          setStatus("valid", "æ ¼å¼åŒ–æˆåŠŸ");
          updateTreeView();
          updateStats();
        } catch (error) {
          showError(`JSON è§£æé”™è¯¯: ${error.message}`);
          setStatus("error", "æ ¼å¼åŒ–å¤±è´¥");
        }
      }

      // å‹ç¼© JSON
      function compressJson() {
        try {
          const input = inputEditor.value.trim();
          if (!input) {
            showError("è¯·è¾“å…¥ JSON æ•°æ®");
            return;
          }

          currentJson = JSON.parse(input);
          const compressed = JSON.stringify(currentJson);
          outputEditor.value = compressed;

          hideError();
          setStatus("valid", "å‹ç¼©æˆåŠŸ");
        } catch (error) {
          showError(`JSON è§£æé”™è¯¯: ${error.message}`);
          setStatus("error", "å‹ç¼©å¤±è´¥");
        }
      }

      // éªŒè¯ JSON
      function validateJson() {
        try {
          const input = inputEditor.value.trim();
          if (!input) {
            showError("è¯·è¾“å…¥ JSON æ•°æ®");
            return;
          }

          JSON.parse(input);
          hideError();
          setStatus("valid", "JSON æ ¼å¼æ­£ç¡® âœ“");
          alert("âœ… JSON æ ¼å¼éªŒè¯é€šè¿‡!");
        } catch (error) {
          showError(`JSON æ ¼å¼é”™è¯¯: ${error.message}`);
          setStatus("error", "JSON æ ¼å¼é”™è¯¯");
          alert(`âŒ JSON æ ¼å¼é”™è¯¯:\n\n${error.message}`);
        }
      }

      // è‡ªåŠ¨éªŒè¯
      function autoValidate() {
        const input = inputEditor.value.trim();
        if (!input) {
          hideError();
          setStatus("valid", "å°±ç»ª");
          return;
        }

        try {
          JSON.parse(input);
          hideError();
          setStatus("valid", "JSON æœ‰æ•ˆ");
        } catch (error) {
          showError(`è¯­æ³•é”™è¯¯: ${error.message}`);
          setStatus("error", "JSON æ— æ•ˆ");
        }
      }

      // æ’åºé”®
      function sortKeys() {
        try {
          const input = inputEditor.value.trim();
          if (!input) {
            showError("è¯·è¾“å…¥ JSON æ•°æ®");
            return;
          }

          currentJson = JSON.parse(input);
          const sorted = sortObjectKeys(currentJson);
          const formatted = JSON.stringify(sorted, null, currentIndent);
          outputEditor.value = formatted;

          hideError();
          setStatus("valid", "é”®å·²æ’åº");
        } catch (error) {
          showError(`JSON è§£æé”™è¯¯: ${error.message}`);
          setStatus("error", "æ’åºå¤±è´¥");
        }
      }

      // é€’å½’æ’åºå¯¹è±¡é”®
      function sortObjectKeys(obj) {
        if (Array.isArray(obj)) {
          return obj.map(sortObjectKeys);
        }
        if (obj !== null && typeof obj === "object") {
          return Object.keys(obj)
            .sort()
            .reduce((sorted, key) => {
              sorted[key] = sortObjectKeys(obj[key]);
              return sorted;
            }, {});
        }
        return obj;
      }

      // æ›´æ–°æ ‘å½¢è§†å›¾
      function updateTreeView() {
        if (!currentJson) {
          treeView.innerHTML = '<div style="color: #999; text-align: center; padding: 40px;">æš‚æ— æ•°æ®</div>';
          return;
        }

        treeView.innerHTML = buildTreeNode(currentJson, "root");
      }

      // æ„å»ºæ ‘èŠ‚ç‚¹
      function buildTreeNode(data, key, level = 0) {
        const indent = "  ".repeat(level);
        let html = "";

        if (Array.isArray(data)) {
          html += `<div>${indent}<span class="tree-toggle" onclick="toggleNode(this)">â–¼</span><span class="tree-key">${key}</span>: [</div>`;
          html += '<div class="tree-node">';
          data.forEach((item, index) => {
            html += buildTreeNode(item, index, level + 1);
          });
          html += `</div><div>${indent}]${level > 0 ? "," : ""}</div>`;
        } else if (data !== null && typeof data === "object") {
          html += `<div>${indent}<span class="tree-toggle" onclick="toggleNode(this)">â–¼</span><span class="tree-key">${key}</span>: {</div>`;
          html += '<div class="tree-node">';
          const keys = Object.keys(data);
          keys.forEach((k, index) => {
            html += buildTreeNode(data[k], k, level + 1);
          });
          html += `</div><div>${indent}}${level > 0 ? "," : ""}</div>`;
        } else {
          const valueClass =
            typeof data === "string"
              ? "tree-string"
              : typeof data === "number"
              ? "tree-number"
              : typeof data === "boolean"
              ? "tree-boolean"
              : "tree-null";
          const value =
            typeof data === "string" ? `"${data}"` : String(data);
          html += `<div>${indent}<span class="tree-key">${key}</span>: <span class="${valueClass}">${value}</span>,</div>`;
        }

        return html;
      }

      // åˆ‡æ¢æ ‘èŠ‚ç‚¹
      function toggleNode(toggle) {
        const node = toggle.parentElement.nextElementSibling;
        if (node && node.classList.contains("tree-node")) {
          node.classList.toggle("tree-collapsed");
          toggle.textContent = node.classList.contains("tree-collapsed")
            ? "â–¶"
            : "â–¼";
        }
      }

      // åˆ‡æ¢é€‰é¡¹å¡
      function switchTab(tabName) {
        document.querySelectorAll(".tab").forEach((tab) => {
          tab.classList.toggle("active", tab.dataset.tab === tabName);
        });
        document.querySelectorAll(".tab-content").forEach((content) => {
          content.classList.toggle("active", content.dataset.content === tabName);
        });

        // æ›´æ–°åŠ¨æ€æ ‡é¢˜
        updateDynamicTitle(tabName);

        // ç‰¹æ®Šå¤„ç†
        if (tabName === "tree") {
          updateTreeView();
        } else if (tabName === "stats") {
          updateDataStats();
        } else if (tabName.startsWith("convert-")) {
          // è‡ªåŠ¨æ‰§è¡Œè½¬æ¢
          handleConvertTab(tabName);
        }
      }

      // æ›´æ–°åŠ¨æ€æ ‡é¢˜
      function updateDynamicTitle(tabName) {
        const titleEl = document.getElementById("dynamicTitle");
        const iconEl = document.getElementById("dynamicIcon");

        const titles = {
          formatted: { text: "æ ¼å¼åŒ–è¾“å‡º", icon: "fa-file-code" },
          tree: { text: "æ ‘å½¢è§†å›¾", icon: "fa-sitemap" },
          stats: { text: "æ•°æ®ç»Ÿè®¡", icon: "fa-chart-simple" },
          "convert-xml": { text: "è½¬æ¢ä¸º XML", icon: "fa-code" },
          "convert-yaml": { text: "è½¬æ¢ä¸º YAML", icon: "fa-file-lines" },
          "convert-csv": { text: "è½¬æ¢ä¸º CSV", icon: "fa-table" },
          "convert-url": { text: "è½¬æ¢ä¸º URLå‚æ•°", icon: "fa-link" },
          "convert-jsobj": { text: "è½¬æ¢ä¸º JSå¯¹è±¡", icon: "fa-brands fa-js" },
          "convert-json2js": { text: "JSå¯¹è±¡è½¬JSON", icon: "fa-bracket-curly" },
          "convert-stringify": { text: "JSONå­—ç¬¦ä¸²åŒ–", icon: "fa-quote-left" },
          "convert-parse": { text: "è§£æJSONå­—ç¬¦ä¸²", icon: "fa-quote-right" }
        };

        const config = titles[tabName];
        if (config) {
          titleEl.textContent = config.text;
          // å¤„ç†fa-brands
          if (config.icon.includes("fa-brands")) {
            iconEl.className = config.icon;
          } else {
            iconEl.className = `fa-solid ${config.icon}`;
          }
        }
      }

      // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
      function updateStats() {
        const input = inputEditor.value;
        charCount.textContent = input.length.toLocaleString();
        lineCount.textContent = (input.match(/\n/g) || []).length + 1;

        const bytes = new Blob([input]).size;
        if (bytes < 1024) {
          sizeInfo.textContent = `${bytes} B`;
        } else if (bytes < 1024 * 1024) {
          sizeInfo.textContent = `${(bytes / 1024).toFixed(2)} KB`;
        } else {
          sizeInfo.textContent = `${(bytes / 1024 / 1024).toFixed(2)} MB`;
        }
      }

      // æ›´æ–°æ•°æ®ç»Ÿè®¡
      function updateDataStats() {
        if (!currentJson) {
          return;
        }

        const stats = analyzeJson(currentJson);
        document.getElementById("statKeys").textContent = stats.keys;
        document.getElementById("statObjects").textContent = stats.objects;
        document.getElementById("statArrays").textContent = stats.arrays;
        document.getElementById("statStrings").textContent = stats.strings;
        document.getElementById("statNumbers").textContent = stats.numbers;
        document.getElementById("statBooleans").textContent = stats.booleans;
        document.getElementById("statNulls").textContent = stats.nulls;
        document.getElementById("statDepth").textContent = stats.maxDepth;
      }

      // åˆ†æ JSON
      function analyzeJson(data, depth = 0) {
        const stats = {
          keys: 0,
          objects: 0,
          arrays: 0,
          strings: 0,
          numbers: 0,
          booleans: 0,
          nulls: 0,
          maxDepth: depth,
        };

        if (Array.isArray(data)) {
          stats.arrays++;
          data.forEach((item) => {
            const childStats = analyzeJson(item, depth + 1);
            mergeStats(stats, childStats);
          });
        } else if (data !== null && typeof data === "object") {
          stats.objects++;
          Object.keys(data).forEach((key) => {
            stats.keys++;
            const childStats = analyzeJson(data[key], depth + 1);
            mergeStats(stats, childStats);
          });
        } else if (typeof data === "string") {
          stats.strings++;
        } else if (typeof data === "number") {
          stats.numbers++;
        } else if (typeof data === "boolean") {
          stats.booleans++;
        } else if (data === null) {
          stats.nulls++;
        }

        return stats;
      }

      // åˆå¹¶ç»Ÿè®¡
      function mergeStats(target, source) {
        target.keys += source.keys;
        target.objects += source.objects;
        target.arrays += source.arrays;
        target.strings += source.strings;
        target.numbers += source.numbers;
        target.booleans += source.booleans;
        target.nulls += source.nulls;
        target.maxDepth = Math.max(target.maxDepth, source.maxDepth);
      }

      // æ ¼å¼è½¬æ¢
      function convertToXml(outputId = "convertOutput") {
        if (!currentJson) {
        // å¦‚æœæ²¡æœ‰æ ¼å¼åŒ–è¿‡ï¼Œå°è¯•è‡ªåŠ¨æ ¼å¼åŒ–è¾“å…¥å†…å®¹
        const input = inputEditor.value.trim();
        if (input) {
          try {
            currentJson = JSON.parse(input);
          } catch (e) {
            alert("è¯·å…ˆæ ¼å¼åŒ– JSON æˆ–è¾“å…¥æœ‰æ•ˆçš„ JSON");
            return;
          }
        } else {
          alert("è¯·å…ˆè¾“å…¥ JSON æ•°æ®");
          return;
        }
      }

        try {
          const xml = jsonToXml(currentJson);
          document.getElementById(outputId).value = xml;
        } catch (error) {
          alert(`è½¬æ¢å¤±è´¥: ${error.message}`);
        }
      }

      function jsonToXml(obj, rootName = "root") {
        let xml = `<?xml version="1.0" encoding="UTF-8"?>\n<${rootName}>\n`;

        function convert(data, indent = "  ") {
          let result = "";
          if (Array.isArray(data)) {
            data.forEach((item) => {
              result += `${indent}<item>\n`;
              result += convert(item, indent + "  ");
              result += `${indent}</item>\n`;
            });
          } else if (data !== null && typeof data === "object") {
            Object.keys(data).forEach((key) => {
              result += `${indent}<${key}>\n`;
              result += convert(data[key], indent + "  ");
              result += `${indent}</${key}>\n`;
            });
          } else {
            result += `${indent}${data}\n`;
          }
          return result;
        }

        xml += convert(obj);
        xml += `</${rootName}>`;
        return xml;
      }

      function convertToYaml(outputId = "convertOutput") {
        if (!currentJson) {
        // å¦‚æœæ²¡æœ‰æ ¼å¼åŒ–è¿‡ï¼Œå°è¯•è‡ªåŠ¨æ ¼å¼åŒ–è¾“å…¥å†…å®¹
        const input = inputEditor.value.trim();
        if (input) {
          try {
            currentJson = JSON.parse(input);
          } catch (e) {
            alert("è¯·å…ˆæ ¼å¼åŒ– JSON æˆ–è¾“å…¥æœ‰æ•ˆçš„ JSON");
            return;
          }
        } else {
          alert("è¯·å…ˆè¾“å…¥ JSON æ•°æ®");
          return;
        }
      }

        try {
          const yaml = jsonToYaml(currentJson);
          document.getElementById(outputId).value = yaml;
        } catch (error) {
          alert(`è½¬æ¢å¤±è´¥: ${error.message}`);
        }
      }

      function jsonToYaml(obj, indent = 0) {
        const indentStr = "  ".repeat(indent);
        let yaml = "";

        if (Array.isArray(obj)) {
          obj.forEach((item) => {
            if (typeof item === "object" && item !== null) {
              yaml += `${indentStr}-\n`;
              yaml += jsonToYaml(item, indent + 1);
            } else {
              yaml += `${indentStr}- ${item}\n`;
            }
          });
        } else if (obj !== null && typeof obj === "object") {
          Object.keys(obj).forEach((key) => {
            if (typeof obj[key] === "object" && obj[key] !== null) {
              yaml += `${indentStr}${key}:\n`;
              yaml += jsonToYaml(obj[key], indent + 1);
            } else {
              yaml += `${indentStr}${key}: ${obj[key]}\n`;
            }
          });
        }

        return yaml;
      }

      function convertToCsv(outputId = "convertOutput") {
        if (!currentJson) {
        // å¦‚æœæ²¡æœ‰æ ¼å¼åŒ–è¿‡ï¼Œå°è¯•è‡ªåŠ¨æ ¼å¼åŒ–è¾“å…¥å†…å®¹
        const input = inputEditor.value.trim();
        if (input) {
          try {
            currentJson = JSON.parse(input);
          } catch (e) {
            alert("è¯·å…ˆæ ¼å¼åŒ– JSON æˆ–è¾“å…¥æœ‰æ•ˆçš„ JSON");
            return;
          }
        } else {
          alert("è¯·å…ˆè¾“å…¥ JSON æ•°æ®");
          return;
        }
      }

        try {
          const csv = jsonToCsv(currentJson);
          document.getElementById(outputId).value = csv;
        } catch (error) {
          alert(`è½¬æ¢å¤±è´¥: ${error.message}`);
        }
      }

      function jsonToCsv(data) {
        if (!Array.isArray(data)) {
          data = [data];
        }

        if (data.length === 0) {
          return "";
        }

        const headers = Object.keys(data[0]);
        let csv = headers.join(",") + "\n";

        data.forEach((row) => {
          const values = headers.map((header) => {
            const value = row[header];
            if (typeof value === "object") {
              return `"${JSON.stringify(value).replace(/"/g, '""')}"`;
            }
            return `"${String(value).replace(/"/g, '""')}"`;
          });
          csv += values.join(",") + "\n";
        });

        return csv;
      }

      function convertToUrlParams(outputId = "convertOutput") {
        if (!currentJson) {
        // å¦‚æœæ²¡æœ‰æ ¼å¼åŒ–è¿‡ï¼Œå°è¯•è‡ªåŠ¨æ ¼å¼åŒ–è¾“å…¥å†…å®¹
        const input = inputEditor.value.trim();
        if (input) {
          try {
            currentJson = JSON.parse(input);
          } catch (e) {
            alert("è¯·å…ˆæ ¼å¼åŒ– JSON æˆ–è¾“å…¥æœ‰æ•ˆçš„ JSON");
            return;
          }
        } else {
          alert("è¯·å…ˆè¾“å…¥ JSON æ•°æ®");
          return;
        }
      }

        try {
          const params = jsonToUrlParams(currentJson);
          document.getElementById(outputId).value = params;
        } catch (error) {
          alert(`è½¬æ¢å¤±è´¥: ${error.message}`);
        }
      }

      function jsonToUrlParams(obj, prefix = "") {
        const params = [];

        Object.keys(obj).forEach((key) => {
          const value = obj[key];
          const paramKey = prefix ? `${prefix}[${key}]` : key;

          if (typeof value === "object" && value !== null && !Array.isArray(value)) {
            params.push(jsonToUrlParams(value, paramKey));
          } else if (Array.isArray(value)) {
            value.forEach((item, index) => {
              params.push(`${paramKey}[${index}]=${encodeURIComponent(item)}`);
            });
          } else {
            params.push(`${paramKey}=${encodeURIComponent(value)}`);
          }
        });

        return params.join("&");
      }

      // JSON è½¬ JavaScript å¯¹è±¡å­—é¢é‡
      function convertToJsObject(outputId = "convertOutput") {
        if (!currentJson) {
        // å¦‚æœæ²¡æœ‰æ ¼å¼åŒ–è¿‡ï¼Œå°è¯•è‡ªåŠ¨æ ¼å¼åŒ–è¾“å…¥å†…å®¹
        const input = inputEditor.value.trim();
        if (input) {
          try {
            currentJson = JSON.parse(input);
          } catch (e) {
            alert("è¯·å…ˆæ ¼å¼åŒ– JSON æˆ–è¾“å…¥æœ‰æ•ˆçš„ JSON");
            return;
          }
        } else {
          alert("è¯·å…ˆè¾“å…¥ JSON æ•°æ®");
          return;
        }
      }

        try {
          // ä½¿ç”¨ JSON.stringify çš„ replacer å’Œ space å‚æ•°ç”Ÿæˆæ ¼å¼åŒ–çš„ JS å¯¹è±¡
          const jsCode = `const obj = ${formatAsJsObject(currentJson, currentIndent)};`;
          document.getElementById(outputId).value = jsCode;
        } catch (error) {
          alert(`è½¬æ¢å¤±è´¥: ${error.message}`);
        }
      }

      // æ ¼å¼åŒ–ä¸º JS å¯¹è±¡å­—é¢é‡
      function formatAsJsObject(obj, indent) {
        const indentStr = typeof indent === "string" ? indent : " ".repeat(indent);

        function format(value, level = 0) {
          const currentIndent = indentStr.repeat(level);
          const nextIndent = indentStr.repeat(level + 1);

          if (value === null) {
            return "null";
          } else if (value === undefined) {
            return "undefined";
          } else if (typeof value === "string") {
            // ä½¿ç”¨å•å¼•å·,å¹¶è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦
            return `'${value.replace(/\\/g, "\\\\").replace(/'/g, "\\'").replace(/\n/g, "\\n").replace(/\r/g, "\\r").replace(/\t/g, "\\t")}'`;
          } else if (typeof value === "number" || typeof value === "boolean") {
            return String(value);
          } else if (Array.isArray(value)) {
            if (value.length === 0) return "[]";
            const items = value.map(item => `${nextIndent}${format(item, level + 1)}`).join(",\n");
            return `[\n${items}\n${currentIndent}]`;
          } else if (typeof value === "object") {
            const keys = Object.keys(value);
            if (keys.length === 0) return "{}";
            const items = keys.map(key => {
              // åˆ¤æ–­é”®æ˜¯å¦éœ€è¦å¼•å·(åŒ…å«ç‰¹æ®Šå­—ç¬¦æˆ–ä¸æ˜¯æœ‰æ•ˆæ ‡è¯†ç¬¦)
              const needQuotes = !/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(key);
              const keyStr = needQuotes ? `'${key}'` : key;
              return `${nextIndent}${keyStr}: ${format(value[key], level + 1)}`;
            }).join(",\n");
            return `{\n${items}\n${currentIndent}}`;
          }
          return String(value);
        }

        return format(obj);
      }

      // JavaScript å¯¹è±¡å­—é¢é‡è½¬ JSON
      function convertJsObjectToJson(outputId = "convertOutput") {
        try {
          const input = inputEditor.value.trim();
          if (!input) {
            alert("è¯·è¾“å…¥ JavaScript å¯¹è±¡ä»£ç ");
            return;
          }

          // æå–å¯¹è±¡å­—é¢é‡(æ”¯æŒå¤šç§æ ¼å¼)
          let jsCode = input;

          // ç§»é™¤å¯èƒ½çš„å˜é‡å£°æ˜(const/let/var obj = {...})
          jsCode = jsCode.replace(/^(const|let|var)\s+\w+\s*=\s*/, "");

          // ç§»é™¤æœ«å°¾çš„åˆ†å·
          jsCode = jsCode.replace(/;+\s*$/, "");

          // å°è¯•ä½¿ç”¨ eval æˆ– Function æ„é€ å™¨å®‰å…¨åœ°è§£æ
          // æ³¨æ„: è¿™é‡Œä½¿ç”¨ Function æ„é€ å™¨ç›¸å¯¹æ›´å®‰å…¨
          const parsed = (new Function(`return ${jsCode}`))();

          // è½¬æ¢ä¸º JSON
          const jsonStr = JSON.stringify(parsed, null, currentIndent);
          document.getElementById(outputId).value = jsonStr;

          // åŒæ—¶æ›´æ–°åˆ°è¾“å‡ºç¼–è¾‘å™¨
          currentJson = parsed;
          outputEditor.value = jsonStr;

          hideError();
          setStatus("valid", "è½¬æ¢æˆåŠŸ");
          
        } catch (error) {
          showError(`è½¬æ¢å¤±è´¥: ${error.message}`);
          alert(`âŒ JavaScript å¯¹è±¡è§£æå¤±è´¥:\n\n${error.message}\n\nè¯·ç¡®ä¿è¾“å…¥çš„æ˜¯æœ‰æ•ˆçš„ JavaScript å¯¹è±¡å­—é¢é‡`);
        }
      }

      // JSON å¯¹è±¡è½¬ JSON å­—ç¬¦ä¸²
      function convertToJsonString(outputId = "convertOutput") {
        if (!currentJson) {
        // å¦‚æœæ²¡æœ‰æ ¼å¼åŒ–è¿‡ï¼Œå°è¯•è‡ªåŠ¨æ ¼å¼åŒ–è¾“å…¥å†…å®¹
        const input = inputEditor.value.trim();
        if (input) {
          try {
            currentJson = JSON.parse(input);
          } catch (e) {
            alert("è¯·å…ˆæ ¼å¼åŒ– JSON æˆ–è¾“å…¥æœ‰æ•ˆçš„ JSON");
            return;
          }
        } else {
          alert("è¯·å…ˆè¾“å…¥ JSON æ•°æ®");
          return;
        }
      }

        try {
          // å°† JSON å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²å½¢å¼(å¸¦è½¬ä¹‰)
          const jsonStr = JSON.stringify(currentJson);
          // å†å°†è¿™ä¸ªå­—ç¬¦ä¸²æœ¬èº«è½¬ä¸º JSON å­—ç¬¦ä¸²(æ·»åŠ å¼•å·å’Œè½¬ä¹‰)
          const escapedStr = JSON.stringify(jsonStr);

          document.getElementById(outputId).value = escapedStr;
        } catch (error) {
          alert(`è½¬æ¢å¤±è´¥: ${error.message}`);
        }
      }

      // JSON å­—ç¬¦ä¸²è½¬ JSON å¯¹è±¡
      function convertJsonStringToObject(outputId = "convertOutput") {
        try {
          const input = inputEditor.value.trim();
          if (!input) {
            alert("è¯·è¾“å…¥ JSON å­—ç¬¦ä¸²");
            return;
          }

          // å…ˆè§£æä¸€æ¬¡å¾—åˆ°å­—ç¬¦ä¸²å†…å®¹
          let jsonString;
          try {
            jsonString = JSON.parse(input);
          } catch (e) {
            // å¦‚æœè§£æå¤±è´¥,å¯èƒ½ç›´æ¥å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²,å°è¯•ç›´æ¥ä½¿ç”¨
            jsonString = input;
          }

          // å¦‚æœå¾—åˆ°çš„æ˜¯å­—ç¬¦ä¸²,å†è§£æä¸€æ¬¡å¾—åˆ°å¯¹è±¡
          if (typeof jsonString === 'string') {
            const jsonObj = JSON.parse(jsonString);
            const formatted = JSON.stringify(jsonObj, null, currentIndent);

            document.getElementById(outputId).value = formatted;

            // åŒæ—¶æ›´æ–°åˆ°è¾“å‡ºç¼–è¾‘å™¨å’Œå½“å‰ JSON
            currentJson = jsonObj;
            outputEditor.value = formatted;

            hideError();
            setStatus("valid", "è½¬æ¢æˆåŠŸ");
            
          } else {
            // å¦‚æœå·²ç»æ˜¯å¯¹è±¡,ç›´æ¥æ ¼å¼åŒ–æ˜¾ç¤º
            const formatted = JSON.stringify(jsonString, null, currentIndent);
            document.getElementById(outputId).value = formatted;

            currentJson = jsonString;
            outputEditor.value = formatted;

            hideError();
            setStatus("valid", "å·²æ˜¯ JSON å¯¹è±¡");
          }
        } catch (error) {
          showError(`è½¬æ¢å¤±è´¥: ${error.message}`);
          alert(`âŒ JSON å­—ç¬¦ä¸²è§£æå¤±è´¥:\n\n${error.message}\n\nè¯·ç¡®ä¿è¾“å…¥çš„æ˜¯æœ‰æ•ˆçš„ JSON å­—ç¬¦ä¸²`);
        }
      }

      // å·¥å…·å‡½æ•°
      function clearAll() {
        inputEditor.value = "";
        outputEditor.value = "";
        convertOutput.value = "";
        currentJson = null;
        hideError();
        setStatus("valid", "å°±ç»ª");
        updateStats();
        treeView.innerHTML = '<div style="color: #999; text-align: center; padding: 40px;">æš‚æ— æ•°æ®</div>';
      }

      function clearInput() {
        inputEditor.value = "";
        updateStats();
        hideError();
        setStatus("valid", "å°±ç»ª");
        // æ¸…ç©ºè¾“å…¥æ—¶ä¹Ÿæ¸…ç©ºè¾“å‡ºå’Œè½¬æ¢ç»“æœ
        currentJson = null;
        clearOutput();
      }

      function clearOutput() {
        // æ¸…ç©ºæ‰€æœ‰è¾“å‡ºåŒºåŸŸ
        outputEditor.value = "";
        document.getElementById("convertOutput").value = "";
        document.getElementById("yamlOutput").value = "";
        document.getElementById("csvOutput").value = "";
        document.getElementById("urlOutput").value = "";
        document.getElementById("jsobjOutput").value = "";
        document.getElementById("json2jsOutput").value = "";
        document.getElementById("stringifyOutput").value = "";
        document.getElementById("parseOutput").value = "";
        // æ¸…ç©ºæ ‘å½¢è§†å›¾
        treeView.innerHTML = '<div style="color: #999; text-align: center; padding: 40px;">æš‚æ— æ•°æ®</div>';
        // æ¸…ç©ºç»Ÿè®¡
        document.querySelectorAll('.stat-value').forEach(el => el.textContent = '0');
      }

      function copyOutput() {
        const text = outputEditor.value;
        if (!text) {
          alert("æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹");
          return;
        }

        navigator.clipboard.writeText(text).then(() => {
          alert("âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿");
        }).catch(() => {
          alert("âŒ å¤åˆ¶å¤±è´¥");
        });
      }

      function downloadJson() {
        const text = outputEditor.value || inputEditor.value;
        if (!text) {
          alert("æ²¡æœ‰å¯ä¸‹è½½çš„å†…å®¹");
          return;
        }

        const blob = new Blob([text], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `json_${Date.now()}.json`;
        a.click();
        URL.revokeObjectURL(url);
      }

      async function pasteFromClipboard() {
        try {
          const text = await navigator.clipboard.readText();
          inputEditor.value = text;
          updateStats();
          autoValidate();
        } catch (error) {
          alert("âŒ ç²˜è´´å¤±è´¥,è¯·æ‰‹åŠ¨ç²˜è´´");
        }
      }

      function loadFile(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          inputEditor.value = e.target.result;
          updateStats();
          autoValidate();
        };
        reader.readAsText(file);
      }

      function showError(message) {
        errorBox.innerHTML = `<strong>âŒ é”™è¯¯</strong>${message}`;
        errorBox.classList.add("show");
      }

      function hideError() {
        errorBox.classList.remove("show");
      }

      function setStatus(type, message) {
        statusBadge.className = `status-badge ${type}`;
        statusBadge.textContent = message;
      }

      // åˆå§‹åŒ–åº”ç”¨
      init();
    </script>
  </body>
</html>
